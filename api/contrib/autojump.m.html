<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>smashlib.contrib.autojump API documentation</title>
    <meta name="description" content="Copyright c 2008-2012 Joel Schaerer
Copyright c 2012-2014 William Ting

* This program is free softw..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.BACKUP_THRESHOLD">BACKUP_THRESHOLD</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.FUZZY_MATCH_THRESHOLD">FUZZY_MATCH_THRESHOLD</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ONE_OR_MORE">ONE_OR_MORE</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.OPTIONAL">OPTIONAL</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.PARSER">PARSER</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.REMAINDER">REMAINDER</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.SMASH_DIR">SMASH_DIR</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.SUPPRESS">SUPPRESS</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.TAB_ENTRIES_COUNT">TAB_ENTRIES_COUNT</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.TAB_SEPARATOR">TAB_SEPARATOR</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.VERSION">VERSION</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ZERO_OR_MORE">ZERO_OR_MORE</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.add_path">add_path</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.create_dir">create_dir</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.decrease_path">decrease_path</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.detect_smartcase">detect_smartcase</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.dictify">dictify</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.encode_local">encode_local</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.entriefy">entriefy</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.find_matches">find_matches</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.first">first</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.get_pwd">get_pwd</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.get_tab_entry_info">get_tab_entry_info</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.handle_tab_completion">handle_tab_completion</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.has_uppercase">has_uppercase</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.in_bash">in_bash</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_autojump_sourced">is_autojump_sourced</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_linux">is_linux</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_osx">is_osx</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_python2">is_python2</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_python3">is_python3</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.is_windows">is_windows</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.last">last</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.load">load</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.load_backup">load_backup</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.main">main</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.match_anywhere">match_anywhere</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.match_consecutive">match_consecutive</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.match_fuzzy">match_fuzzy</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.migrate_osx_xdg_data">migrate_osx_xdg_data</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.move_file">move_file</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.parse_arguments">parse_arguments</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.print_entry">print_entry</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.print_local">print_local</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.print_stats">print_stats</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.purge_missing_paths">purge_missing_paths</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.sanitize">sanitize</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.save">save</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.second">second</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.set_defaults">set_defaults</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.surround_quotes">surround_quotes</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.tab_menu">tab_menu</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.take">take</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.unico">unico</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.Action">Action</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.Action.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter">ArgumentDefaultsHelpFormatter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.__init__">__init__</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_argument">add_argument</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_arguments">add_arguments</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_text">add_text</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_usage">add_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.end_section">end_section</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.format_help">format_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.start_section">start_section</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.ArgumentError">ArgumentError</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentError.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.ArgumentParser">ArgumentParser</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.__init__">__init__</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.add_argument">add_argument</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.add_argument_group">add_argument_group</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.add_mutually_exclusive_group">add_mutually_exclusive_group</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.add_subparsers">add_subparsers</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.convert_arg_line_to_args">convert_arg_line_to_args</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.error">error</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.exit">exit</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.format_help">format_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.format_usage">format_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.format_version">format_version</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.get_default">get_default</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.parse_args">parse_args</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.parse_known_args">parse_known_args</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.print_help">print_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.print_usage">print_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.print_version">print_version</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.register">register</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.ArgumentParser.set_defaults">set_defaults</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.ArgumentTypeError">ArgumentTypeError</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.Entry">Entry</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.FileType">FileType</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.FileType.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.__init__">__init__</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.add_argument">add_argument</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.add_arguments">add_arguments</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.add_text">add_text</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.add_usage">add_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.end_section">end_section</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.format_help">format_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.HelpFormatter.start_section">start_section</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.Namespace">Namespace</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.Namespace.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.__init__">__init__</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_argument">add_argument</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_arguments">add_arguments</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_text">add_text</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_usage">add_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.end_section">end_section</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.format_help">format_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.start_section">start_section</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter">RawTextHelpFormatter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.__init__">__init__</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.add_argument">add_argument</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.add_arguments">add_arguments</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.add_text">add_text</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.add_usage">add_usage</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.end_section">end_section</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.format_help">format_help</a></li>
    <li class="mono"><a href="#smashlib.contrib.autojump.RawTextHelpFormatter.start_section">start_section</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">smashlib.contrib.autojump</span> module</h1>
  <p>Copyright c 2008-2012 Joel Schaerer
Copyright c 2012-2014 William Ting</p>
<ul>
<li>
<p>This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3, or (at your option)
any later version.</p>
</li>
<li>
<p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
</li>
<li>
<p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software Foundation, Inc.,
51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>
</li>
</ul>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump" class="source">
    <div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># adapted from the original code for programmatic (not cli) usage</span>
<span class="c"># original code is here: https://github.com/kennethreitz/autoenv</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Copyright c 2008-2012 Joel Schaerer</span>
<span class="sd">  Copyright c 2012-2014 William Ting</span>

<span class="sd">  * This program is free software; you can redistribute it and/or modify</span>
<span class="sd">  it under the terms of the GNU General Public License as published by</span>
<span class="sd">  the Free Software Foundation; either version 3, or (at your option)</span>
<span class="sd">  any later version.</span>

<span class="sd">  * This program is distributed in the hope that it will be useful,</span>
<span class="sd">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">  GNU General Public License for more details.</span>

<span class="sd">  * You should have received a copy of the GNU General Public License</span>
<span class="sd">  along with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="sd">  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">smashlib.data</span> <span class="kn">import</span> <span class="n">SMASH_DIR</span>

<span class="kn">from</span> <span class="nn">difflib</span> <span class="kn">import</span> <span class="n">SequenceMatcher</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">ifilter</span> <span class="o">=</span> <span class="nb">filter</span>
    <span class="n">imap</span> <span class="o">=</span> <span class="nb">map</span>
    <span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">ifilter</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">imap</span>

<span class="kn">import</span> <span class="nn">copy</span> <span class="kn">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="kn">as</span> <span class="nn">_re</span>

<span class="kn">import</span> <span class="nn">textwrap</span> <span class="kn">as</span> <span class="nn">_textwrap</span>

<span class="kn">from</span> <span class="nn">gettext</span> <span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">set</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c"># for python &lt; 2.4 compatibility (sets module is there since 2.3):</span>
    <span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">basestring</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">basestring</span> <span class="o">=</span> <span class="nb">str</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">sorted</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c"># for python &lt; 2.4 compatibility:</span>
    <span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__call__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;__bases__&#39;</span><span class="p">)</span>


<span class="n">SUPPRESS</span> <span class="o">=</span> <span class="s">&#39;==SUPPRESS==&#39;</span>

<span class="n">OPTIONAL</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span>
<span class="n">ZERO_OR_MORE</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
<span class="n">ONE_OR_MORE</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
<span class="n">PARSER</span> <span class="o">=</span> <span class="s">&#39;A...&#39;</span>
<span class="n">REMAINDER</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
<span class="n">_UNRECOGNIZED_ARGS_ATTR</span> <span class="o">=</span> <span class="s">&#39;_unrecognized_args&#39;</span>

<span class="c"># =============================</span>
<span class="c"># Utility functions and classes</span>
<span class="c"># =============================</span>


<span class="k">class</span> <span class="nc">_AttributeHolder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Abstract base class that provides __repr__.</span>

<span class="sd">    The __repr__ method returns a string in the format::</span>
<span class="sd">        ClassName(attr=name, attr=name, ...)</span>
<span class="sd">    The attributes are determined either by a class-level attribute,</span>
<span class="sd">    &#39;_kwarg_names&#39;, or by inspecting the instance __dict__.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">type_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">arg_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_args</span><span class="p">():</span>
            <span class="n">arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_kwargs</span><span class="p">():</span>
            <span class="n">arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">_ensure_value</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="c"># ===============</span>
<span class="c"># Formatting Help</span>
<span class="c"># ===============</span>

<span class="k">class</span> <span class="nc">HelpFormatter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Formatter for generating usage messages and argument help strings.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">prog</span><span class="p">,</span>
                 <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># default setting for width</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
            <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>

    <span class="c"># ===============================</span>
    <span class="c"># Section and indentation methods</span>
    <span class="c"># ===============================</span>
    <span class="k">def</span> <span class="nf">_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_dedent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;Indent decreased below 0.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">class</span> <span class="nc">_Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="n">heading</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c"># format the indented section</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
            <span class="n">join</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_join_parts</span>
            <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">item_help</span> <span class="o">=</span> <span class="n">join</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

            <span class="c"># return nothing if the section was empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item_help</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;&#39;</span>

            <span class="c"># add the heading if the section was non-empty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">current_indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_current_indent</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="c"># join the section-initial newline, the heading and the help</span>
            <span class="k">return</span> <span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">item_help</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

    <span class="c"># ========================</span>
    <span class="c"># Message building methods</span>
    <span class="c"># ========================</span>
    <span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>

    <span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>

            <span class="c"># find all invocations</span>
            <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
            <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>

            <span class="c"># update the maximum item length</span>
            <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
            <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                          <span class="n">action_length</span><span class="p">)</span>

            <span class="c"># add the item to the list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Help-formatting methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
            <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">return</span> <span class="n">help</span>

    <span class="k">def</span> <span class="nf">_join_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_strings</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">part</span>
                        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">part_strings</span>
                        <span class="k">if</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;usage: &#39;</span><span class="p">)</span>

        <span class="c"># if usage is specified, use that</span>
        <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

        <span class="c"># if no optionals or positionals are available, usage is just prog</span>
        <span class="k">elif</span> <span class="n">usage</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

        <span class="c"># if optionals and positionals are available, calculate usage</span>
        <span class="k">elif</span> <span class="n">usage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

            <span class="c"># split optionals from positionals</span>
            <span class="n">optionals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">positionals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="n">optionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">positionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="c"># build full usage string</span>
            <span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_actions_usage</span>
            <span class="n">action_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">optionals</span> <span class="o">+</span> <span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">prog</span><span class="p">,</span> <span class="n">action_usage</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">])</span>

            <span class="c"># wrap the usage parts if it&#39;s too long</span>
            <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">text_width</span><span class="p">:</span>

                <span class="c"># break usage into wrappable parts</span>
                <span class="n">part_regexp</span> <span class="o">=</span> <span class="s">r&#39;\(.*?\)+|\[.*?\]+|\S+&#39;</span>
                <span class="n">opt_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">optionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
                <span class="n">pos_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
                <span class="n">opt_parts</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">part_regexp</span><span class="p">,</span> <span class="n">opt_usage</span><span class="p">)</span>
                <span class="n">pos_parts</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">part_regexp</span><span class="p">,</span> <span class="n">pos_usage</span><span class="p">)</span>
                <span class="k">assert</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opt_parts</span><span class="p">)</span> <span class="o">==</span> <span class="n">opt_usage</span>
                <span class="k">assert</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">)</span> <span class="o">==</span> <span class="n">pos_usage</span>

                <span class="c"># helper for wrapping lines</span>
                <span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">text_width</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                        <span class="n">line_len</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">):]</span>
                    <span class="k">return</span> <span class="n">lines</span>

                <span class="c"># if prog is short, follow it with optionals or positionals</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">text_width</span><span class="p">:</span>
                    <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">opt_parts</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">([</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">opt_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">pos_parts</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">([</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">prog</span><span class="p">]</span>

                <span class="c"># if prog is long, put it on its own line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">opt_parts</span> <span class="o">+</span> <span class="n">pos_parts</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">opt_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span>

                <span class="c"># join lines into usage</span>
                <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="c"># prefix with &#39;usage:&#39;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">usage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_actions_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
        <span class="c"># find group indices and identify actions in groups</span>
        <span class="n">group_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">inserts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">actions</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                        <span class="n">group_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">inserts</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; [&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;]&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">inserts</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; (&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;)&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;|&#39;</span>

        <span class="c"># collect all actions format strings</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">actions</span><span class="p">):</span>

            <span class="c"># suppressed arguments are marked with None</span>
            <span class="c"># remove | separators for suppressed arguments</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inserts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                    <span class="n">inserts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inserts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                    <span class="n">inserts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c"># produce all arg strings</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

                <span class="c"># if it&#39;s in a group, strip the outer []</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group_actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span> <span class="ow">and</span> <span class="n">part</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;]&#39;</span><span class="p">:</span>
                        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c"># add the action string to the list</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

            <span class="c"># produce the first way to invoke the option in brackets</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_string</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c"># if the Optional doesn&#39;t take a value, format is:</span>
                <span class="c">#    -s or --long</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">option_string</span>

                <span class="c"># if the Optional takes a value, format is:</span>
                <span class="c">#    -s ARGS or --long ARGS</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">args_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="n">args_string</span><span class="p">)</span>

                <span class="c"># make it look optional if it&#39;s not required or in a group</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">required</span> <span class="ow">and</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_actions</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">part</span>

                <span class="c"># add the action string to the list</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

        <span class="c"># insert things at the necessary indices</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inserts</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">inserts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="c"># join all the action items with spaces</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parts</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">])</span>

        <span class="c"># clean up separators for mutually exclusive groups</span>
        <span class="nb">open</span> <span class="o">=</span> <span class="s">r&#39;[\[(]&#39;</span>
        <span class="n">close</span> <span class="o">=</span> <span class="s">r&#39;[\])]&#39;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(</span><span class="si">%s</span><span class="s">) &#39;</span> <span class="o">%</span> <span class="nb">open</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">close</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;</span><span class="si">%s</span><span class="s"> *</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="p">),</span> <span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\(([^|]*)\)&#39;</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># return the text</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;%(prog)&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>
        <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_width</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">_format_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="c"># determine the required width and the entry label</span>
        <span class="n">help_position</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span><span class="p">)</span>
        <span class="n">help_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="n">help_position</span>
        <span class="n">action_width</span> <span class="o">=</span> <span class="n">help_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">action_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c"># ho nelp; start on same line and add a final newline</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tup</span>

        <span class="c"># short action name; start on the same line and pad two spaces</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_header</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">action_width</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_width</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%-*s</span><span class="s">  &#39;</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># long action name; start on the next line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="n">help_position</span>

        <span class="c"># collect the pieces of the action help</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">action_header</span><span class="p">]</span>

        <span class="c"># if there was help for the action, add lines of help text</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">help_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_help</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">help_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_lines</span><span class="p">(</span><span class="n">help_text</span><span class="p">,</span> <span class="n">help_width</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent_first</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">help_position</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

        <span class="c"># or add a newline if the description doesn&#39;t end with one</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">action_header</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># if there are any sub-actions, add their help as well</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>

        <span class="c"># return a single string</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_action_invocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="n">metavar</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metavar_formatter</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metavar</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c"># if the Optional doesn&#39;t take a value, format is:</span>
            <span class="c">#    -s, --long</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">)</span>

            <span class="c"># if the Optional takes a value, format is:</span>
            <span class="c">#    -s ARGS, --long ARGS</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">args_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="n">args_string</span><span class="p">))</span>

            <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_metavar_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">metavar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">metavar</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">choice_strs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">choice_strs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">default_metavar</span>

        <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">tuple_size</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">tuple_size</span>
        <span class="k">return</span> <span class="n">format</span>

    <span class="k">def</span> <span class="nf">_format_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">):</span>
        <span class="n">get_metavar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metavar_formatter</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s"> ...]]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ONE_OR_MORE</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s"> ...]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> ...&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">)]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_expand_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">action</span><span class="p">),</span> <span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="s">&#39;__name__&#39;</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;choices&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">choices_str</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;choices&#39;</span><span class="p">]])</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choices_str</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_help_string</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">%</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">_iter_indented_subactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_subactions</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">_get_subactions</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="n">get_subactions</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">subaction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_split_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fill_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                              <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_help_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span>


<span class="k">class</span> <span class="nc">RawDescriptionHelpFormatter</span><span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which retains any formatting in descriptions.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_fill_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">indent</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="bp">True</span><span class="p">)])</span>


<span class="k">class</span> <span class="nc">RawTextHelpFormatter</span><span class="p">(</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which retains formatting of all help text.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_split_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ArgumentDefaultsHelpFormatter</span><span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which adds default values to argument help.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_help_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span>
        <span class="k">if</span> <span class="s">&#39;%(default)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">defaulting_nargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">,</span> <span class="n">ZERO_OR_MORE</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">in</span> <span class="n">defaulting_nargs</span><span class="p">:</span>
                    <span class="n">help</span> <span class="o">+=</span> <span class="s">&#39; (default: </span><span class="si">%(default)s</span><span class="s">)&#39;</span>
        <span class="k">return</span> <span class="n">help</span>


<span class="c"># =====================</span>
<span class="c"># Options and Arguments</span>
<span class="c"># =====================</span>

<span class="k">def</span> <span class="nf">_get_action_name</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">argument</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argument</span><span class="o">.</span><span class="n">option_strings</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">metavar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">SUPPRESS</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">argument</span><span class="o">.</span><span class="n">metavar</span>
    <span class="k">elif</span> <span class="n">argument</span><span class="o">.</span><span class="n">dest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">SUPPRESS</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">argument</span><span class="o">.</span><span class="n">dest</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">ArgumentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;An error from creating or using an argument (optional or positional).</span>

<span class="sd">    The string value of this exception is the message, augmented with</span>
<span class="sd">    information about the argument that caused it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;argument </span><span class="si">%(argument_name)s</span><span class="s">: </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="k">return</span> <span class="n">format</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                             <span class="n">argument_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArgumentTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;An error from trying to convert a command line string to a type.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="c"># ==============</span>
<span class="c"># Action classes</span>
<span class="c"># ==============</span>

<span class="k">class</span> <span class="nc">Action</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Information about how to convert command line strings to Python objects.</span>

<span class="sd">    Action objects are used by an ArgumentParser to represent the information</span>
<span class="sd">    needed to parse a single argument from one or more strings from the</span>
<span class="sd">    command line. The keyword arguments to the Action constructor are also</span>
<span class="sd">    all attributes of Action instances.</span>

<span class="sd">    Keyword Arguments:</span>

<span class="sd">        - option_strings -- A list of command-line option strings which</span>
<span class="sd">            should be associated with this action.</span>

<span class="sd">        - dest -- The name of the attribute to hold the created object(s)</span>

<span class="sd">        - nargs -- The number of command-line arguments that should be</span>
<span class="sd">            consumed. By default, one argument will be consumed and a single</span>
<span class="sd">            value will be produced.  Other values include:</span>
<span class="sd">                - N (an integer) consumes N arguments (and produces a list)</span>
<span class="sd">                - &#39;?&#39; consumes zero or one arguments</span>
<span class="sd">                - &#39;*&#39; consumes zero or more arguments (and produces a list)</span>
<span class="sd">                - &#39;+&#39; consumes one or more arguments (and produces a list)</span>
<span class="sd">            Note that the difference between the default and nargs=1 is that</span>
<span class="sd">            with the default, a single value will be produced, while with</span>
<span class="sd">            nargs=1, a list containing a single value will be produced.</span>

<span class="sd">        - const -- The value to be produced if the option is specified and the</span>
<span class="sd">            option uses an action that takes no values.</span>

<span class="sd">        - default -- The value to be produced if the option is not specified.</span>

<span class="sd">        - type -- The type which the command-line arguments should be converted</span>
<span class="sd">            to, should be one of &#39;string&#39;, &#39;int&#39;, &#39;float&#39;, &#39;complex&#39; or a</span>
<span class="sd">            callable object that accepts a single string argument. If None,</span>
<span class="sd">            &#39;string&#39; is assumed.</span>

<span class="sd">        - choices -- A container of values that should be allowed. If not None,</span>
<span class="sd">            after a command-line argument has been converted to the appropriate</span>
<span class="sd">            type, an exception will be raised if it is not a member of this</span>
<span class="sd">            collection.</span>

<span class="sd">        - required -- True if the action must always be specified at the</span>
<span class="sd">            command line. This is only meaningful for optional command-line</span>
<span class="sd">            arguments.</span>

<span class="sd">        - help -- The help string describing the argument.</span>

<span class="sd">        - metavar -- The name to be used for the option&#39;s argument with the</span>
<span class="sd">            help string. If None, the &#39;dest&#39; value will be used as the name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span> <span class="o">=</span> <span class="n">option_strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="n">const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metavar</span> <span class="o">=</span> <span class="n">metavar</span>

    <span class="k">def</span> <span class="nf">_get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;option_strings&#39;</span><span class="p">,</span>
            <span class="s">&#39;dest&#39;</span><span class="p">,</span>
            <span class="s">&#39;nargs&#39;</span><span class="p">,</span>
            <span class="s">&#39;const&#39;</span><span class="p">,</span>
            <span class="s">&#39;default&#39;</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">,</span>
            <span class="s">&#39;choices&#39;</span><span class="p">,</span>
            <span class="s">&#39;help&#39;</span><span class="p">,</span>
            <span class="s">&#39;metavar&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;.__call__() not defined&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">_StoreAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;nargs for store actions must be &gt; 0; if you &#39;</span>
                             <span class="s">&#39;have nothing to store, actions such as store &#39;</span>
                             <span class="s">&#39;true or store const may be more appropriate&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">const</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">nargs</span> <span class="o">!=</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;nargs must be </span><span class="si">%r</span><span class="s"> to supply const&#39;</span> <span class="o">%</span> <span class="n">OPTIONAL</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_StoreAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_StoreConstAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">const</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_StoreConstAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">const</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_StoreTrueAction</span><span class="p">(</span><span class="n">_StoreConstAction</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_StoreTrueAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_StoreFalseAction</span><span class="p">(</span><span class="n">_StoreConstAction</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_StoreFalseAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_AppendAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;nargs for append actions must be &gt; 0; if arg &#39;</span>
                             <span class="s">&#39;strings are not supplying the value to append, &#39;</span>
                             <span class="s">&#39;the append const action may be more appropriate&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">const</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">nargs</span> <span class="o">!=</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;nargs must be </span><span class="si">%r</span><span class="s"> to supply const&#39;</span> <span class="o">%</span> <span class="n">OPTIONAL</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_AppendAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">_ensure_value</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_AppendConstAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">const</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_AppendConstAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">_ensure_value</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">const</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_CountAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_CountAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">new_count</span> <span class="o">=</span> <span class="n">_ensure_value</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">new_count</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_HelpAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_HelpAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_VersionAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="s">&quot;show program&#39;s version number and exit&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_VersionAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">version</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">_SubParsersAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">_ChoicesPseudoAction</span><span class="p">(</span><span class="n">Action</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">help</span><span class="p">):</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">_SubParsersAction</span><span class="o">.</span><span class="n">_ChoicesPseudoAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">sup</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">option_strings</span><span class="o">=</span><span class="p">[],</span> <span class="n">dest</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">prog</span><span class="p">,</span>
                 <span class="n">parser_class</span><span class="p">,</span>
                 <span class="n">dest</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prog_prefix</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parser_class</span> <span class="o">=</span> <span class="n">parser_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name_parser_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_choices_actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">_SubParsersAction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
            <span class="n">nargs</span><span class="o">=</span><span class="n">PARSER</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_parser_map</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># set prog from the existing prefix</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prog&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog_prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c"># create a pseudo-action to hold the choice help</span>
        <span class="k">if</span> <span class="s">&#39;help&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;help&#39;</span><span class="p">)</span>
            <span class="n">choice_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ChoicesPseudoAction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_choices_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">choice_action</span><span class="p">)</span>

        <span class="c"># create the parser and add it to the map</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name_parser_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">_get_subactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choices_actions</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">parser_name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">arg_strings</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c"># set the parser name if requested</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">parser_name</span><span class="p">)</span>

        <span class="c"># select the parser</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_parser_map</span><span class="p">[</span><span class="n">parser_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="n">parser_name</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name_parser_map</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;unknown parser </span><span class="si">%r</span><span class="s"> (choices: </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">tup</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c"># parse all the remaining options into the namespace</span>
        <span class="c"># store any unrecognized options on the object, so that the top</span>
        <span class="c"># level parser can decide what to do with them</span>
        <span class="n">namespace</span><span class="p">,</span> <span class="n">arg_strings</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span>
            <span class="n">arg_strings</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arg_strings</span><span class="p">:</span>
            <span class="nb">vars</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">,</span> <span class="p">[])</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>


<span class="c"># ==============</span>
<span class="c"># Type classes</span>
<span class="c"># ==============</span>

<span class="k">class</span> <span class="nc">FileType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Factory for creating file object types</span>

<span class="sd">    Instances of FileType are typically passed as type= arguments to the</span>
<span class="sd">    ArgumentParser add_argument() method.</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        - mode -- A string indicating how the file is to be opened. Accepts the</span>
<span class="sd">            same values as the builtin open() function.</span>
<span class="sd">        - bufsize -- The file&#39;s desired buffer size. Accepts the same values as</span>
<span class="sd">            the builtin open() function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span> <span class="o">=</span> <span class="n">bufsize</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="c"># the special argument &quot;-&quot; means sys.std{in,out}</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">elif</span> <span class="s">&#39;w&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;argument &quot;-&quot; with mode </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># all other arguments are used as file names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">]</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">args_str</span><span class="p">)</span>

<span class="c"># ===========================</span>
<span class="c"># Optional and Positional Parsing</span>
<span class="c"># ===========================</span>


<span class="k">class</span> <span class="nc">Namespace</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Simple object for storing attributes.</span>

<span class="sd">    Implements equality by attribute names and values, and provides a simple</span>
<span class="sd">    string representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="n">__hash__</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">vars</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>


<span class="k">class</span> <span class="nc">_ActionsContainer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">description</span><span class="p">,</span>
                 <span class="n">prefix_chars</span><span class="p">,</span>
                 <span class="n">argument_default</span><span class="p">,</span>
                 <span class="n">conflict_handler</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_ActionsContainer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_default</span> <span class="o">=</span> <span class="n">argument_default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span> <span class="o">=</span> <span class="n">prefix_chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conflict_handler</span> <span class="o">=</span> <span class="n">conflict_handler</span>

        <span class="c"># set up registries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registries</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># register actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">_StoreAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">_StoreAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">_StoreConstAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">_StoreTrueAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">_StoreFalseAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;append&#39;</span><span class="p">,</span> <span class="n">_AppendAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;append_const&#39;</span><span class="p">,</span> <span class="n">_AppendConstAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;count&#39;</span><span class="p">,</span> <span class="n">_CountAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="n">_HelpAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">_VersionAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="s">&#39;parsers&#39;</span><span class="p">,</span> <span class="n">_SubParsersAction</span><span class="p">)</span>

        <span class="c"># raise an exception if the conflict handler is invalid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_handler</span><span class="p">()</span>

        <span class="c"># action storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># defaults storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># determines whether an &quot;option&quot; looks like a negative number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_negative_number_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^-\d+$|^-\d*\.\d+$&#39;</span><span class="p">)</span>

        <span class="c"># whether or not there are any optionals that look like negative</span>
        <span class="c"># numbers -- uses a list so it can be shared and edited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># ====================</span>
    <span class="c"># Registration methods</span>
    <span class="c"># ====================</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="n">registry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registries</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">registry_name</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">registry</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span>

    <span class="k">def</span> <span class="nf">_registry_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registries</span><span class="p">[</span><span class="n">registry_name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="c"># ==================================</span>
    <span class="c"># Namespace default accessor methods</span>
    <span class="c"># ==================================</span>
    <span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># if these defaults match any existing arguments, replace</span>
        <span class="c"># the previous default on the object with the new one</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="o">==</span> <span class="n">dest</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Adding argument actions</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add_argument(dest, ..., name=value, ...)</span>
<span class="sd">        add_argument(option_string, option_string, ..., name=value, ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># if no positional args are supplied or only one is supplied and</span>
        <span class="c"># it doesn&#39;t look like an option string, parse a positional</span>
        <span class="c"># argument</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="s">&#39;dest&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;dest supplied twice for positional argument&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># otherwise, we&#39;re adding an optional argument</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optional_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># if no default was supplied, use the parser-level default</span>
        <span class="k">if</span> <span class="s">&#39;default&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dest&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_default</span>

        <span class="c"># create the action object, and add it to the parser</span>
        <span class="n">action_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_action_class</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">action_class</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknown action &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">action_class</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">action_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># raise an error if the action type is not callable</span>
        <span class="n">type_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry_get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">type_func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not callable&#39;</span> <span class="o">%</span> <span class="n">type_func</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_argument_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">_ArgumentGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">add_mutually_exclusive_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">_MutuallyExclusiveGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">_add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="c"># resolve any conflicts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_conflict</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c"># add to actions list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">action</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c"># index the action by any option strings it has</span>
        <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>

        <span class="c"># set the flag if any option strings look like negative numbers</span>
        <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_negative_number_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">option_string</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># return the created action</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_remove_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_container_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
        <span class="c"># collect groups by titles</span>
        <span class="n">title_group_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">title_group_map</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;cannot merge actions - two groups are named </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
            <span class="n">title_group_map</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span>

        <span class="c"># map each action to its group</span>
        <span class="n">group_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>

            <span class="c"># if a group with the title exists, use that, otherwise</span>
            <span class="c"># create a new group matching the container&#39;s group</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">title</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">title_group_map</span><span class="p">:</span>
                <span class="n">title_group_map</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                    <span class="n">description</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="n">conflict_handler</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">conflict_handler</span><span class="p">)</span>

            <span class="c"># map the actions to their new group</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                <span class="n">group_map</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_group_map</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">]</span>

        <span class="c"># add container&#39;s mutually exclusive groups</span>
        <span class="c"># NOTE: if add_mutually_exclusive_group ever gains title= and</span>
        <span class="c"># description= then this code will need to be expanded as above</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">:</span>
            <span class="n">mutex_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span>
                <span class="n">required</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">required</span><span class="p">)</span>

            <span class="c"># map the actions to their new mutex group</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                <span class="n">group_map</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutex_group</span>

        <span class="c"># add all actions to this container or their group</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="n">group_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_positional_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># make sure required is not specified</span>
        <span class="k">if</span> <span class="s">&#39;required&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;&#39;required&#39; is an invalid argument for positionals&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># mark positional arguments as required if at least one is</span>
        <span class="c"># always required</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nargs&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">,</span> <span class="n">ZERO_OR_MORE</span><span class="p">]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;required&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nargs&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span> <span class="ow">and</span> <span class="s">&#39;default&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;required&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># return the keyword arguments with no option strings</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">option_strings</span><span class="o">=</span><span class="p">[])</span>

    <span class="k">def</span> <span class="nf">_get_optional_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># determine short and long option strings</span>
        <span class="n">option_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">long_option_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="c"># error on strings that don&#39;t start with an appropriate prefix</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid option string </span><span class="si">%r</span><span class="s">: &#39;</span>
                        <span class="s">&#39;must start with a character </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">tup</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">tup</span><span class="p">)</span>

            <span class="c"># strings starting with two prefix characters are long options</span>
            <span class="n">option_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option_string</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_string</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">:</span>
                        <span class="n">long_option_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option_string</span><span class="p">)</span>

        <span class="c"># infer destination, &#39;--foo-bar&#39; -&gt; &#39;foo_bar&#39; and &#39;-x&#39; -&gt; &#39;x&#39;</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;dest&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">long_option_strings</span><span class="p">:</span>
                <span class="n">dest_option_string</span> <span class="o">=</span> <span class="n">long_option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest_option_string</span> <span class="o">=</span> <span class="n">option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">dest_option_string</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dest</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;dest= is required for options like </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">option_string</span><span class="p">)</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>

        <span class="c"># return the updated keyword arguments</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_action_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry_get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># determine function from conflict handler string</span>
        <span class="n">handler_func_name</span> <span class="o">=</span> <span class="s">&#39;_handle_conflict_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">conflict_handler</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler_func_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid conflict_resolution value: </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">conflict_handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>

        <span class="c"># find all options that conflict with this option</span>
        <span class="n">confl_optionals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="n">confl_optional</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                <span class="n">confl_optionals</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">option_string</span><span class="p">,</span> <span class="n">confl_optional</span><span class="p">))</span>

        <span class="c"># resolve any conflicts</span>
        <span class="k">if</span> <span class="n">confl_optionals</span><span class="p">:</span>
            <span class="n">conflict_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_handler</span><span class="p">()</span>
            <span class="n">conflict_handler</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">confl_optionals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_conflict_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">conflicting_actions</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;conflicting option string(s): </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">conflict_string</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">option_string</span>
                                     <span class="k">for</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">caction</span>
                                     <span class="ow">in</span> <span class="n">conflicting_actions</span><span class="p">])</span>
        <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">message</span> <span class="o">%</span> <span class="n">conflict_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_conflict_resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">conflicting_actions</span><span class="p">):</span>

        <span class="c"># remove all conflicting options</span>
        <span class="k">for</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">conflicting_actions</span><span class="p">:</span>

            <span class="c"># remove the conflicting option</span>
            <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">option_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

            <span class="c"># if the option now has no option string, remove it from the</span>
            <span class="c"># container holding it</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                <span class="n">action</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">_remove_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_ArgumentGroup</span><span class="p">(</span><span class="n">_ActionsContainer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># add any missing keyword arguments by checking the container</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span>
        <span class="n">update</span><span class="p">(</span><span class="s">&#39;conflict_handler&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">conflict_handler</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="s">&#39;prefix_chars&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">)</span>
        <span class="n">update</span><span class="p">(</span><span class="s">&#39;argument_default&#39;</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">argument_default</span><span class="p">)</span>
        <span class="n">super_init</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">_ArgumentGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span>
        <span class="n">super_init</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># group attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># share most attributes with the container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_registries</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_registries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_option_string_actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span> <span class="o">=</span> \
            <span class="n">container</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span>

    <span class="k">def</span> <span class="nf">_add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">action</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">_ArgumentGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_remove_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_ArgumentGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_remove_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_actions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_MutuallyExclusiveGroup</span><span class="p">(</span><span class="n">_ArgumentGroup</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_MutuallyExclusiveGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_container</span> <span class="o">=</span> <span class="n">container</span>

    <span class="k">def</span> <span class="nf">_add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;mutually exclusive arguments must be optional&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_remove_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_container</span><span class="o">.</span><span class="n">_remove_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_actions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">,</span> <span class="n">_ActionsContainer</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Object for parsing command line strings into Python objects.</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        - prog -- The name of the program (default: sys.argv[0])</span>
<span class="sd">        - usage -- A usage message (default: auto-generated from arguments)</span>
<span class="sd">        - description -- A description of what the program does</span>
<span class="sd">        - epilog -- Text following the argument descriptions</span>
<span class="sd">        - parents -- Parsers whose arguments should be copied into this one</span>
<span class="sd">        - formatter_class -- HelpFormatter class for printing help messages</span>
<span class="sd">        - prefix_chars -- Characters that prefix optional arguments</span>
<span class="sd">        - fromfile_prefix_chars -- Characters that prefix files containing</span>
<span class="sd">            additional arguments</span>
<span class="sd">        - argument_default -- The default value for all arguments</span>
<span class="sd">        - conflict_handler -- String indicating how to handle conflicts</span>
<span class="sd">        - add_help -- Add a -h/-help option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">prog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">usage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">epilog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">parents</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">formatter_class</span><span class="o">=</span><span class="n">HelpFormatter</span><span class="p">,</span>
                 <span class="n">prefix_chars</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span>
                 <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">argument_default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">conflict_handler</span><span class="o">=</span><span class="s">&#39;error&#39;</span><span class="p">,</span>
                 <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">warnings</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;The &quot;version&quot; argument to ArgumentParser is deprecated. &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;Please use &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;&quot;add_argument(..., action=&#39;version&#39;, version=&quot;N&quot;, ...)&quot; &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;instead&quot;&quot;&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>

        <span class="n">superinit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArgumentParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span>
        <span class="n">superinit</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                  <span class="n">prefix_chars</span><span class="o">=</span><span class="n">prefix_chars</span><span class="p">,</span>
                  <span class="n">argument_default</span><span class="o">=</span><span class="n">argument_default</span><span class="p">,</span>
                  <span class="n">conflict_handler</span><span class="o">=</span><span class="n">conflict_handler</span><span class="p">)</span>

        <span class="c"># default setting for prog</span>
        <span class="k">if</span> <span class="n">prog</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epilog</span> <span class="o">=</span> <span class="n">epilog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter_class</span> <span class="o">=</span> <span class="n">formatter_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span> <span class="o">=</span> <span class="n">fromfile_prefix_chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span> <span class="o">=</span> <span class="n">add_help</span>

        <span class="n">add_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;positional arguments&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_optionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;optional arguments&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># register types</span>
        <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span>

        <span class="c"># add help and version arguments if necessary</span>
        <span class="c"># (using explicit default to override global argument_default)</span>
        <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">prefix_chars</span><span class="p">:</span>
            <span class="n">default_prefix</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_prefix</span> <span class="o">=</span> <span class="n">prefix_chars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;help&#39;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;show this help message and exit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;version&#39;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;show program&#39;s version number and exit&quot;</span><span class="p">))</span>

        <span class="c"># add parent arguments and defaults</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_container_actions</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">defaults</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_defaults</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Pretty __repr__ methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">_get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;prog&#39;</span><span class="p">,</span>
            <span class="s">&#39;usage&#39;</span><span class="p">,</span>
            <span class="s">&#39;description&#39;</span><span class="p">,</span>
            <span class="s">&#39;version&#39;</span><span class="p">,</span>
            <span class="s">&#39;formatter_class&#39;</span><span class="p">,</span>
            <span class="s">&#39;conflict_handler&#39;</span><span class="p">,</span>
            <span class="s">&#39;add_help&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

    <span class="c"># ==================================</span>
    <span class="c"># Optional/Positional adding methods</span>
    <span class="c"># ==================================</span>
    <span class="k">def</span> <span class="nf">add_subparsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;cannot have multiple subparser arguments&#39;</span><span class="p">))</span>

        <span class="c"># add the parser class to the arguments if it&#39;s not present</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;parser_class&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;subcommands&#39;</span><span class="p">))</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span>

        <span class="c"># prog defaults to the usage message of this parser, skipping</span>
        <span class="c"># optional arguments and with no &quot;usage:&quot; prefix</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prog&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
            <span class="n">positionals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_actions</span><span class="p">()</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># create the parsers action and add it to the positionals list</span>
        <span class="n">parsers_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_action_class</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s">&#39;parsers&#39;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">parsers_class</span><span class="p">(</span><span class="n">option_strings</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c"># return the created parsers action</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optionals</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_get_optional_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">action</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_positional_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">action</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">]</span>

    <span class="c"># =====================================</span>
    <span class="c"># Command line argument parsing methods</span>
    <span class="c"># =====================================</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">argv</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;unrecognized arguments: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># args default to the system args</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c"># default Namespace built from parser defaults</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>

        <span class="c"># add any action defaults that aren&#39;t present</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

        <span class="c"># add any parser defaults that aren&#39;t present</span>
        <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">])</span>

        <span class="c"># parse the arguments and exit if there are any errors</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">))</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span>
        <span class="k">except</span> <span class="n">ArgumentError</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="c"># replace arg strings that are file references</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">arg_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_args_from_files</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>

        <span class="c"># map all mutually exclusive arguments to the other arguments</span>
        <span class="c"># they can&#39;t occur with</span>
        <span class="n">action_conflicts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mutex_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">:</span>
            <span class="n">group_actions</span> <span class="o">=</span> <span class="n">mutex_group</span><span class="o">.</span><span class="n">_group_actions</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutex_action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mutex_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">):</span>
                <span class="n">conflicts</span> <span class="o">=</span> <span class="n">action_conflicts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">mutex_action</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group_actions</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group_actions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="c"># find all option indices, and determine the arg_string_pattern</span>
        <span class="c"># which has an &#39;O&#39; if there is an option at an index,</span>
        <span class="c"># an &#39;A&#39; if there is an argument, or a &#39;-&#39; if there is a &#39;--&#39;</span>
        <span class="n">option_string_indices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">arg_string_pattern_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arg_strings_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arg_strings_iter</span><span class="p">):</span>

            <span class="c"># all args after -- are non-options</span>
            <span class="k">if</span> <span class="n">arg_string</span> <span class="o">==</span> <span class="s">&#39;--&#39;</span><span class="p">:</span>
                <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="n">arg_strings_iter</span><span class="p">:</span>
                    <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span>

            <span class="c"># otherwise, add the arg to the arg strings</span>
            <span class="c"># and note the index if it was an option</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_optional</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">option_tuple</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">option_string_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_tuple</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;O&#39;</span>
                <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

        <span class="c"># join the pieces together to form the pattern</span>
        <span class="n">arg_strings_pattern</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_string_pattern_parts</span><span class="p">)</span>

        <span class="c"># converts arg strings to the appropriate and then takes the action</span>
        <span class="n">seen_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">seen_non_default_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">argument_strings</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">seen_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">argument_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">argument_strings</span><span class="p">)</span>

            <span class="c"># error if this argument is not allowed with other previously</span>
            <span class="c"># seen arguments, assuming that actions that use the default</span>
            <span class="c"># value don&#39;t really count as &quot;present&quot;</span>
            <span class="k">if</span> <span class="n">argument_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
                <span class="n">seen_non_default_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">conflict_action</span> <span class="ow">in</span> <span class="n">action_conflicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">conflict_action</span> <span class="ow">in</span> <span class="n">seen_non_default_actions</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;not allowed with argument </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">action_name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">conflict_action</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">action_name</span><span class="p">)</span>

            <span class="c"># take the action if we didn&#39;t receive a SUPPRESS value</span>
            <span class="c"># (e.g. from a default)</span>
            <span class="k">if</span> <span class="n">argument_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">argument_values</span><span class="p">,</span> <span class="n">option_string</span><span class="p">)</span>

        <span class="c"># function to convert arg_strings into an optional action</span>
        <span class="k">def</span> <span class="nf">consume_optional</span><span class="p">(</span><span class="n">start_index</span><span class="p">):</span>

            <span class="c"># get the optional identified at this index</span>
            <span class="n">option_tuple</span> <span class="o">=</span> <span class="n">option_string_indices</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span>
            <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">option_tuple</span>

            <span class="c"># identify additional optionals in the same arg string</span>
            <span class="c"># (e.g. -xyz is the same as -x -y -z if no args are required)</span>
            <span class="n">match_argument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_argument</span>
            <span class="n">action_tuples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

                <span class="c"># if we found no optional action, skip it</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">extras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c"># if there is an explicit argument, try to match the</span>
                <span class="c"># optional&#39;s string arguments to only this</span>
                <span class="k">if</span> <span class="n">explicit_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">arg_count</span> <span class="o">=</span> <span class="n">match_argument</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>

                    <span class="c"># if the action is a single-dash option and takes no</span>
                    <span class="c"># arguments, try to parse more single-dash options out</span>
                    <span class="c"># of the tail of the option string</span>
                    <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
                    <span class="k">if</span> <span class="n">arg_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
                        <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="p">[],</span> <span class="n">option_string</span><span class="p">))</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">option_string</span> <span class="o">=</span> <span class="n">char</span> <span class="o">+</span> <span class="n">explicit_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">new_explicit_arg</span> <span class="o">=</span> <span class="n">explicit_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="bp">None</span>
                        <span class="n">optionals_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span>
                        <span class="k">if</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">optionals_map</span><span class="p">:</span>
                            <span class="n">action</span> <span class="o">=</span> <span class="n">optionals_map</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                            <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">new_explicit_arg</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;ignored explicit argument </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">explicit_arg</span><span class="p">)</span>

                    <span class="c"># if the action expect exactly one argument, we&#39;ve</span>
                    <span class="c"># successfully matched the option; exit the loop</span>
                    <span class="k">elif</span> <span class="n">arg_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">explicit_arg</span><span class="p">]</span>
                        <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">))</span>
                        <span class="k">break</span>

                    <span class="c"># error if a double-dash option did not use the</span>
                    <span class="c"># explicit argument</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;ignored explicit argument </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">explicit_arg</span><span class="p">)</span>

                <span class="c"># if there is no explicit argument, try to match the</span>
                <span class="c"># optional&#39;s string arguments with the following strings</span>
                <span class="c"># if successful, exit the loop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">selected_patterns</span> <span class="o">=</span> <span class="n">arg_strings_pattern</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span>
                    <span class="n">arg_count</span> <span class="o">=</span> <span class="n">match_argument</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">selected_patterns</span><span class="p">)</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">arg_count</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">))</span>
                    <span class="k">break</span>

            <span class="c"># add the Optional to the list and return the index at which</span>
            <span class="c"># the Optional&#39;s string args stopped</span>
            <span class="k">assert</span> <span class="n">action_tuples</span>
            <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action_tuples</span><span class="p">:</span>
                <span class="n">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stop</span>

        <span class="c"># the list of Positionals left to be parsed; this is modified</span>
        <span class="c"># by consume_positionals()</span>
        <span class="n">positionals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_actions</span><span class="p">()</span>

        <span class="c"># function to convert arg_strings into positional actions</span>
        <span class="k">def</span> <span class="nf">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">):</span>
            <span class="c"># match as many Positionals as possible</span>
            <span class="n">match_partial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_arguments_partial</span>
            <span class="n">selected_pattern</span> <span class="o">=</span> <span class="n">arg_strings_pattern</span><span class="p">[</span><span class="n">start_index</span><span class="p">:]</span>
            <span class="n">arg_counts</span> <span class="o">=</span> <span class="n">match_partial</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">selected_pattern</span><span class="p">)</span>

            <span class="c"># slice off the appropriate arg strings for each Positional</span>
            <span class="c"># and add the Positional and its args to the list</span>
            <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">arg_counts</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">arg_count</span><span class="p">]</span>
                <span class="n">start_index</span> <span class="o">+=</span> <span class="n">arg_count</span>
                <span class="n">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

            <span class="c"># slice off the Positionals that we just parsed and return the</span>
            <span class="c"># index at which the Positionals&#39; string args stopped</span>
            <span class="n">positionals</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">positionals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_counts</span><span class="p">):]</span>
            <span class="k">return</span> <span class="n">start_index</span>

        <span class="c"># consume Positionals and Optionals alternately, until we have</span>
        <span class="c"># passed the last option string</span>
        <span class="n">extras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">option_string_indices</span><span class="p">:</span>
            <span class="n">max_option_string_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">option_string_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_option_string_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">start_index</span> <span class="o">&lt;=</span> <span class="n">max_option_string_index</span><span class="p">:</span>

            <span class="c"># consume any Positionals preceding the next option</span>
            <span class="n">next_option_string_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span>
                <span class="n">index</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">option_string_indices</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">start_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="o">!=</span> <span class="n">next_option_string_index</span><span class="p">:</span>
                <span class="n">positionals_end_index</span> <span class="o">=</span> <span class="n">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

                <span class="c"># only try to parse the next optional if we didn&#39;t consume</span>
                <span class="c"># the option string during the positionals parsing</span>
                <span class="k">if</span> <span class="n">positionals_end_index</span> <span class="o">&gt;</span> <span class="n">start_index</span><span class="p">:</span>
                    <span class="n">start_index</span> <span class="o">=</span> <span class="n">positionals_end_index</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start_index</span> <span class="o">=</span> <span class="n">positionals_end_index</span>

            <span class="c"># if we consumed all the positionals we could and we&#39;re not</span>
            <span class="c"># at the index of an option string, there were extra arguments</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">option_string_indices</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">next_option_string_index</span><span class="p">]</span>
                <span class="n">extras</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">next_option_string_index</span>

            <span class="c"># consume the next optional and any arguments for it</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">consume_optional</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

        <span class="c"># consume any positionals following the last Optional</span>
        <span class="n">stop_index</span> <span class="o">=</span> <span class="n">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

        <span class="c"># if we didn&#39;t consume all the argument strings, there were extras</span>
        <span class="n">extras</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">[</span><span class="n">stop_index</span><span class="p">:])</span>

        <span class="c"># if we didn&#39;t use all the Positional objects, there were too few</span>
        <span class="c"># arg strings supplied.</span>
        <span class="k">if</span> <span class="n">positionals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;too few arguments&#39;</span><span class="p">))</span>

        <span class="c"># make sure all required actions were present</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_actions</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;argument </span><span class="si">%s</span><span class="s"> is required&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="c"># make sure all required groups had one option present</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">seen_non_default_actions</span><span class="p">:</span>
                        <span class="k">break</span>

                <span class="c"># if no actions were used, report the error</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_action_name</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span>
                             <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">]</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;one of the arguments </span><span class="si">%s</span><span class="s"> is required&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>

        <span class="c"># return the updated namespace and the extra arguments</span>
        <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">extras</span>

    <span class="k">def</span> <span class="nf">_read_args_from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">):</span>
        <span class="c"># expand arguments referencing files</span>
        <span class="n">new_arg_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">:</span>

            <span class="c"># for regular arguments, just add them back into the list</span>
            <span class="k">if</span> <span class="n">arg_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span><span class="p">:</span>
                <span class="n">new_arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

            <span class="c"># replace arguments referencing files with the file content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">arg_string</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">arg_strings</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">arg_line</span> <span class="ow">in</span> <span class="n">args_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_arg_line_to_args</span><span class="p">(</span><span class="n">arg_line</span><span class="p">):</span>
                                <span class="n">arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                        <span class="n">arg_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_args_from_files</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
                        <span class="n">new_arg_strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">args_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

        <span class="c"># return the modified argument list</span>
        <span class="k">return</span> <span class="n">new_arg_strings</span>

    <span class="k">def</span> <span class="nf">convert_arg_line_to_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_line</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">arg_line</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_match_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">):</span>
        <span class="c"># match the pattern for this action to the arg strings</span>
        <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nargs_pattern</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nargs_pattern</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">)</span>

        <span class="c"># raise an exception if we weren&#39;t able to find a match</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nargs_errors</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">None</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected one argument&#39;</span><span class="p">),</span>
                <span class="n">OPTIONAL</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected at most one argument&#39;</span><span class="p">),</span>
                <span class="n">ONE_OR_MORE</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected at least one argument&#39;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected </span><span class="si">%s</span><span class="s"> argument(s)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">nargs_errors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c"># return the number of arguments matched</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_match_arguments_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">):</span>
        <span class="c"># progressively shorten the actions list by slicing off the</span>
        <span class="c"># final actions until we find a match</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">actions_slice</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_nargs_pattern</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions_slice</span><span class="p">])</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()])</span>
                <span class="k">break</span>

        <span class="c"># return the list of arg string counts</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_parse_optional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">):</span>
        <span class="c"># if it&#39;s an empty string, it was meant to be a positional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if it doesn&#39;t start with a prefix, it was meant to be positional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if the option string is present in the parser, return the action</span>
        <span class="k">if</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">arg_string</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">,</span> <span class="bp">None</span>

        <span class="c"># if it&#39;s just a single character, it was meant to be positional</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if the option string before the &quot;=&quot; is present, return the action</span>
        <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">arg_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>

        <span class="c"># search through all possible prefixes of the option string</span>
        <span class="c"># and all actions in the parser for possible interpretations</span>
        <span class="n">option_tuples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_option_tuples</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

        <span class="c"># if multiple actions match, the option string was ambiguous</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tuples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">ostring</span> <span class="k">for</span> <span class="n">oaction</span><span class="p">,</span> <span class="n">ostring</span><span class="p">,</span> <span class="n">earg</span> <span class="ow">in</span> <span class="n">option_tuples</span><span class="p">])</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="n">arg_string</span><span class="p">,</span> <span class="n">options</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;ambiguous option: </span><span class="si">%s</span><span class="s"> could match </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tup</span><span class="p">)</span>

        <span class="c"># if exactly one action matched, this segmentation is good,</span>
        <span class="c"># so return the parsed action</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tuples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">option_tuple</span><span class="p">,</span> <span class="o">=</span> <span class="n">option_tuples</span>
            <span class="k">return</span> <span class="n">option_tuple</span>

        <span class="c"># if it was not found as an option, but it looks like a negative</span>
        <span class="c"># number, it was meant to be positional</span>
        <span class="c"># unless there are negative-number-like options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_negative_number_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">arg_string</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if it contains a space, it was meant to be a positional</span>
        <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">in</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># it was meant to be an optional but there is no such option</span>
        <span class="c"># in this parser (though it might be a valid option in a subparser)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_get_option_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_string</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># option strings starting with two prefix characters are only</span>
        <span class="c"># split at the &#39;=&#39;</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
        <span class="k">if</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">option_string</span><span class="p">:</span>
                <span class="n">option_prefix</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">option_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_prefix</span> <span class="o">=</span> <span class="n">option_string</span>
                <span class="n">explicit_arg</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">option_prefix</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

        <span class="c"># single character options can be concatenated with their arguments</span>
        <span class="c"># but multiple character options always have to have their argument</span>
        <span class="c"># separate</span>
        <span class="k">elif</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="n">option_prefix</span> <span class="o">=</span> <span class="n">option_string</span>
            <span class="n">explicit_arg</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">short_option_prefix</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">short_explicit_arg</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option_string</span> <span class="o">==</span> <span class="n">short_option_prefix</span><span class="p">:</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">short_explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">option_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">option_prefix</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

        <span class="c"># shouldn&#39;t ever get here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;unexpected option string: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">option_string</span><span class="p">)</span>

        <span class="c"># return the collected option tuples</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_nargs_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="c"># in all examples below, we have to allow for &#39;--&#39; args</span>
        <span class="c"># which are represented as &#39;-&#39; in the pattern</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span>

        <span class="c"># the default (None) is assumed to be a single argument</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A-*)&#39;</span>

        <span class="c"># allow zero or one arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A?-*)&#39;</span>

        <span class="c"># allow zero or more arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*[A-]*)&#39;</span>

        <span class="c"># allow one or more arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">ONE_OR_MORE</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A[A-]*)&#39;</span>

        <span class="c"># allow any number of options or arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;([-AO]*)&#39;</span>

        <span class="c"># allow one argument followed by any number of options or arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A[-AO]*)&#39;</span>

        <span class="c"># all others should be integers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*</span><span class="si">%s</span><span class="s">-*)&#39;</span> <span class="o">%</span> <span class="s">&#39;-*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;A&#39;</span> <span class="o">*</span> <span class="n">nargs</span><span class="p">)</span>

        <span class="c"># if this is an optional action, -- is not allowed</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="n">nargs_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-*&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="n">nargs_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># return the pattern</span>
        <span class="k">return</span> <span class="n">nargs_pattern</span>

    <span class="c"># ========================</span>
    <span class="c"># Value conversion methods</span>
    <span class="c"># ========================</span>
    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">):</span>
        <span class="c"># for everything but PARSER args, strip out &#39;--&#39;</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PARSER</span><span class="p">,</span> <span class="n">REMAINDER</span><span class="p">]:</span>
            <span class="n">arg_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">arg_strings</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="s">&#39;--&#39;</span><span class="p">]</span>

        <span class="c"># optional argument produces a default when not present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_strings</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">const</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># when nargs=&#39;*&#39; on a positional, if there were no command-line</span>
        <span class="c"># args, use the default if it is anything other than None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">arg_strings</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span> <span class="ow">and</span>
              <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">arg_strings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># single argument or optional argument produces a single value</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">OPTIONAL</span><span class="p">]:</span>
            <span class="n">arg_string</span><span class="p">,</span> <span class="o">=</span> <span class="n">arg_strings</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># REMAINDER arguments convert all values, checking none</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>

        <span class="c"># PARSER arguments convert all values, but check only the first</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c"># all other types of nargs produce a list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c"># return the converted value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">):</span>
        <span class="n">type_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry_get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">type_func</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not callable&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">type_func</span><span class="p">)</span>

        <span class="c"># convert the value to the appropriate type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">type_func</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

        <span class="c"># ArgumentTypeErrors indicate errors</span>
        <span class="k">except</span> <span class="n">ArgumentTypeError</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&#39;__name__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c"># TypeErrors or ValueErrors also indicate errors</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&#39;__name__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid </span><span class="si">%s</span><span class="s"> value: </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">))</span>

        <span class="c"># return the converted value</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># converted value must be one of the choices (if specified)</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid choice: </span><span class="si">%r</span><span class="s"> (choose from </span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Help-formatting methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>

        <span class="c"># usage</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>

        <span class="c"># description</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="c"># positionals, optionals and user-defined groups</span>
        <span class="k">for</span> <span class="n">action_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">start_section</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">end_section</span><span class="p">()</span>

        <span class="c"># epilog</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epilog</span><span class="p">)</span>

        <span class="c"># determine help from format above</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s">&#39;The format_version method is deprecated -- the &quot;version&quot; &#39;</span>
            <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter_class</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">)</span>

    <span class="c"># =====================</span>
    <span class="c"># Help-printing methods</span>
    <span class="c"># =====================</span>
    <span class="k">def</span> <span class="nf">print_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_usage</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_help</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s">&#39;The print_version method is deprecated -- the &quot;version&quot; &#39;</span>
            <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_version</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c"># ===============</span>
    <span class="c"># Exiting methods</span>
    <span class="c"># ===============</span>
    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;error(message: string)</span>

<span class="sd">        Prints a usage message incorporating the message to stderr and</span>
<span class="sd">        exits.</span>

<span class="sd">        If you override this in a subclass, it should not return -- it</span>
<span class="sd">        should either exit or raise an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_usage</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: error: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>


<span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="nb">open</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="kn">import</span> <span class="nn">unicodedata</span>



<span class="k">def</span> <span class="nf">create_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a directory atomically.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exception</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
            <span class="k">raise</span>


<span class="k">def</span> <span class="nf">encode_local</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts string into user&#39;s preferred encoding.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">string</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">get_tab_entry_info</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tab entry in the following format return needle, index, and path:</span>

<span class="sd">        [needle]__[index]__[path]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">needle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="n">match_needle</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;(.*?)&#39;</span> <span class="o">+</span> <span class="n">separator</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">match_index</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;([0-9]{1})&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">match_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;[0-9]{1}&#39;</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;(.*)&#39;</span><span class="p">,</span>
        <span class="n">entry</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match_needle</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">match_needle</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match_index</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_index</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">match_path</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">match_path</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">needle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">get_pwd</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Current directory no longer exists.&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">raise</span>


<span class="k">def</span> <span class="nf">has_uppercase</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Lu&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">in_bash</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;bash&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;SHELL&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_autojump_sourced</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;1&#39;</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;AUTOJUMP_SOURCED&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_python2</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">is_python3</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">is_linux</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span>


<span class="k">def</span> <span class="nf">is_osx</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Darwin&#39;</span>


<span class="k">def</span> <span class="nf">is_windows</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span>


<span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tmp</span>


<span class="k">def</span> <span class="nf">move_file</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atomically move file.</span>

<span class="sd">    Windows does not allow for atomic file renaming (which is used by</span>
<span class="sd">    os.rename / shutil.move) so destination paths must first be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_windows</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
        <span class="c"># raises exception if file is in use on Windows</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="n">print_local</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.1f</span><span class="s">:</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">print_local</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">encode_local</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_local</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">encode_local</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">tab_menu</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">tab_entries</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the tab completion menu according to the following format:</span>

<span class="sd">        [needle]__[index]__[possible_match]</span>

<span class="sd">    The needle (search pattern) and index are necessary to recreate the results</span>
<span class="sd">    on subsequent calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab_entries</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_local</span><span class="p">(</span>
            <span class="s">&#39;</span><span class="si">%s%s%d%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">needle</span><span class="p">,</span>
                <span class="n">separator</span><span class="p">,</span>
                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">separator</span><span class="p">,</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">sanitize</span><span class="p">(</span><span class="n">directories</span><span class="p">):</span>
    <span class="c"># edge case to allow &#39;/&#39; as a valid path</span>
    <span class="n">clean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">unico</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="k">else</span> <span class="n">unico</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">imap</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">directories</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python2</span><span class="p">():</span>
            <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">surround_quotes</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bash has problems dealing with certain paths so we&#39;re surrounding all</span>
<span class="sd">    path outputs with quotes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">in_bash</span><span class="p">()</span> <span class="ow">and</span> <span class="n">string</span><span class="p">:</span>
        <span class="c"># Python 2.6 requres field numbers</span>
        <span class="k">return</span> <span class="s">&#39;&quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>


<span class="k">def</span> <span class="nf">take</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return first n items of an iterable.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">islice</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">unico</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts into Unicode string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_python2</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>


<span class="n">BACKUP_THRESHOLD</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span>
<span class="n">Entry</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;Entry&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">,</span> <span class="s">&#39;weight&#39;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">dictify</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a list of entries into a dictionary where</span>
<span class="sd">        key = path</span>
<span class="sd">        value = weight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">weight</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">entriefy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a dictionary into an iterator of entries.&quot;&quot;&quot;</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">imap</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a dictonary (key=path, value=weight) loaded from data file.&quot;&quot;&quot;</span>
    <span class="n">xdg_aj_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span>
        <span class="s">&#39;.local&#39;</span><span class="p">,</span>
        <span class="s">&#39;share&#39;</span><span class="p">,</span>
        <span class="s">&#39;autojump&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_osx</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">):</span>
        <span class="n">migrate_osx_xdg_data</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c"># example: u&#39;10.0\t/home/user\n&#39; -&gt; [&#39;10.0&#39;, u&#39;/home/user&#39;]</span>
    <span class="n">parse</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">correct_length</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c"># example: [&#39;10.0&#39;, u&#39;/home/user&#39;] -&gt; (u&#39;/home/user&#39;, 10.0)</span>
    <span class="n">tupleize</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">],</span>
                <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">imap</span><span class="p">(</span>
                    <span class="n">tupleize</span><span class="p">,</span>
                    <span class="n">ifilter</span><span class="p">(</span><span class="n">correct_length</span><span class="p">,</span> <span class="n">imap</span><span class="p">(</span><span class="n">parse</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">load_backup</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">load_backup</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">]):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">migrate_osx_xdg_data</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Older versions incorrectly used Linux XDG_DATA_HOME paths on OS X. This</span>
<span class="sd">    migrates autojump files from ~/.local/share/autojump to ~/Library/autojump</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_osx</span><span class="p">(),</span> <span class="s">&quot;This function should only be run on OS X.&quot;</span>

    <span class="n">xdg_data_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span> <span class="s">&#39;.local&#39;</span><span class="p">,</span> <span class="s">&#39;share&#39;</span><span class="p">)</span>
    <span class="n">xdg_aj_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">,</span> <span class="s">&#39;autojump&#39;</span><span class="p">)</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt&#39;</span><span class="p">)</span>
    <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt.bak&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span>

    <span class="c"># cleanup</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save data and create backup, creating a new data file if necessary.&quot;&quot;&quot;</span>
    <span class="n">create_dir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]))</span>

    <span class="c"># atomically save by writing to temporary file and moving to destination</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># Windows cannot reuse the same open file name</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unico</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">path</span><span class="p">)))</span>

            <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Error saving autojump data (disk full?)&quot;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># move temp_file -&gt; autojump.txt</span>
    <span class="n">move_file</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>

    <span class="c"># create backup file if it doesn&#39;t exist or is older than BACKUP_THRESHOLD</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">BACKUP_THRESHOLD</span><span class="p">):</span>  <span class="c"># noqa</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span>

<span class="n">VERSION</span> <span class="o">=</span> <span class="s">&#39;22.2.1-beta&#39;</span>
<span class="n">FUZZY_MATCH_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">TAB_ENTRIES_COUNT</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">TAB_SEPARATOR</span> <span class="o">=</span> <span class="s">&#39;__&#39;</span>


<span class="k">def</span> <span class="nf">set_defaults</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data_home</span><span class="o">=</span><span class="n">SMASH_DIR</span>
    <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt.bak&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>


<span class="k">def</span> <span class="nf">parse_arguments</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s">&#39;Automatically jump to directory passed as an argument.&#39;</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s">&quot;Please see autojump(1) man pages for full documentation.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;directory&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;DIRECTORY&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;directory to jump to&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="s">&#39;--add&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;DIRECTORY&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;add path&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="s">&#39;--increase&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;WEIGHT&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;increase current directory weight&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--decrease&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;WEIGHT&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;decrease current directory weight&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--complete&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;used for tab completion&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--purge&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;remove non-existent paths from database&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-s&#39;</span><span class="p">,</span> <span class="s">&#39;--stat&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;show database entries and their key weights&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(prog)s</span><span class="s"> v&quot;</span> <span class="o">+</span>
        <span class="n">VERSION</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;show version information&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a new path or increment an existing one.</span>

<span class="sd">    os.path.realpath() is not used because it&#39;s preferable to use symlinks</span>
<span class="sd">    with resulting duplicate entries in the database than a single canonical</span>
<span class="sd">    path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">unico</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">weight</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">decrease_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decrease or zero out a path.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">unico</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">detect_smartcase</span><span class="p">(</span><span class="n">needles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If any needles contain an uppercase letter then use case sensitive</span>
<span class="sd">    searching. Otherwise use case insensitive searching.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">imap</span><span class="p">(</span><span class="n">has_uppercase</span><span class="p">,</span> <span class="n">needles</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">needles</span><span class="p">,</span> <span class="n">check_entries</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an iterator to matching entries.&quot;&quot;&quot;</span>
    <span class="c"># TODO(wting|2014-02-24): replace assertion with unit test</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s">&quot;Needles must be a list.&quot;</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">detect_smartcase</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># using closure to prevent constantly hitting hdd</span>
    <span class="k">def</span> <span class="nf">is_cwd</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">pwd</span>

    <span class="k">if</span> <span class="n">check_entries</span><span class="p">:</span>
        <span class="n">path_exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">True</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">entries</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">),</span>
        <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="ow">not</span> <span class="n">is_cwd</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path_exists</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
        <span class="n">chain</span><span class="p">(</span>
            <span class="n">match_consecutive</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">),</span>
            <span class="n">match_fuzzy</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">),</span>
            <span class="n">match_anywhere</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">handle_tab_completion</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="n">tab_needle</span><span class="p">,</span> <span class="n">tab_index</span><span class="p">,</span> <span class="n">tab_path</span> <span class="o">=</span> <span class="n">get_tab_entry_info</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">TAB_SEPARATOR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tab_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tab_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">tab_index</span><span class="p">:</span>
        <span class="n">get_ith_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">take</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">))</span><span class="o">.</span><span class="n">path</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">get_ith_path</span><span class="p">(</span>
            <span class="n">tab_index</span><span class="p">,</span>
            <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">tab_needle</span><span class="p">],</span> <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">tab_needle</span><span class="p">:</span>
        <span class="c"># found partial tab completion entry</span>
        <span class="k">return</span> <span class="n">tab_menu</span><span class="p">(</span>
            <span class="n">tab_needle</span><span class="p">,</span>
            <span class="n">take</span><span class="p">(</span><span class="n">TAB_ENTRIES_COUNT</span><span class="p">,</span> <span class="n">find_matches</span><span class="p">(</span>
                <span class="n">entries</span><span class="p">,</span>
                <span class="p">[</span><span class="n">tab_needle</span><span class="p">],</span>
                <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
            <span class="n">TAB_SEPARATOR</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tab_menu</span><span class="p">(</span>
            <span class="n">needle</span><span class="p">,</span>
            <span class="n">take</span><span class="p">(</span><span class="n">TAB_ENTRIES_COUNT</span><span class="p">,</span> <span class="n">find_matches</span><span class="p">(</span>
                <span class="n">entries</span><span class="p">,</span>
                <span class="p">[</span><span class="n">needle</span><span class="p">],</span>
                <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
            <span class="n">TAB_SEPARATOR</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">match_anywhere</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches needles anywhere in the path as long as they&#39;re in the same (but</span>
<span class="sd">    not necessary consecutive) order.</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;baz&#39;]</span>
<span class="sd">        regex needle = r&#39;.*foo.*baz.*&#39;</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/baz/foo/bar&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>

<span class="sd">        result = [</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">regex_needle</span> <span class="o">=</span> <span class="s">&#39;.*&#39;</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span>
    <span class="n">regex_flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span> <span class="k">if</span> <span class="n">ignore_case</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span>
    <span class="n">found</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">haystack</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regex_needle</span><span class="p">,</span>
        <span class="n">haystack</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">regex_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">match_consecutive</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches consecutive needles at the end of a path.</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;baz&#39;]</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz/moo&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>

<span class="sd">        regex_needle = re.compile(r&#39;&#39;&#39;</span>
<span class="sd">            foo     # needle #1</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            /       # os.sep</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            baz     # needle #2</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            $       # end of string</span>
<span class="sd">            &#39;&#39;&#39;)</span>

<span class="sd">        result = [</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># The normal \\ separator needs to be escaped again for use in regex.</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">is_windows</span><span class="p">()</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">regex_no_sep</span> <span class="o">=</span> <span class="s">&#39;[^&#39;</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;]*&#39;</span>
    <span class="n">regex_no_sep_end</span> <span class="o">=</span> <span class="n">regex_no_sep</span> <span class="o">+</span> <span class="s">&#39;$&#39;</span>
    <span class="n">regex_one_sep</span> <span class="o">=</span> <span class="n">regex_no_sep</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">regex_no_sep</span>
    <span class="c"># can&#39;t use compiled regex because of flags</span>
    <span class="n">regex_needle</span> <span class="o">=</span> <span class="n">regex_one_sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">regex_no_sep_end</span>  <span class="c"># noqa</span>
    <span class="n">regex_flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span> <span class="k">if</span> <span class="n">ignore_case</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span>
    <span class="n">found</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regex_needle</span><span class="p">,</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">regex_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">match_fuzzy</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an approximate match with the last needle against the end of</span>
<span class="sd">    every path past an acceptable threshold (FUZZY_MATCH_THRESHOLD).</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;bar&#39;]</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=11),</span>
<span class="sd">            (path=&quot;/foo/baz/moo&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/bar&quot;, weight=10)]</span>

<span class="sd">    result = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=11),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/bar&quot;, weight=10)]</span>

<span class="sd">    This is a weak heuristic and used as a last resort to find matches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">end_dir</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ignore_case</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">last</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">match_percent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">SequenceMatcher</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="n">needle</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">end_dir</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">last</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span>
        <span class="n">match_percent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">SequenceMatcher</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="n">needle</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">end_dir</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
    <span class="n">meets_threshold</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">match_percent</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">&gt;=</span> \
        <span class="n">FUZZY_MATCH_THRESHOLD</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">meets_threshold</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">purge_missing_paths</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove non-existent paths from a list of entries.&quot;&quot;&quot;</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;________________________________________</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="se">\t</span><span class="s"> total weight&quot;</span> <span class="o">%</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="se">\t</span><span class="s"> number of entries&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">print_local</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">:</span><span class="se">\t</span><span class="s"> current directory weight&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c"># current directory no longer exists</span>
        <span class="k">pass</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">data:</span><span class="se">\t</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data_path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>  <span class="c"># noqa</span>
    <span class="c">#if not is_autojump_sourced() and not is_windows():</span>
    <span class="c">#    print(&quot;Please source the correct autojump file in your shell&#39;s&quot;)</span>
    <span class="c">#    print(&quot;startup file. For more information, please reinstall autojump&quot;)</span>
    <span class="c">#    print(&quot;and read the post installation instructions.&quot;)</span>
    <span class="c">#    return 1</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">set_defaults</span><span class="p">()</span>

    <span class="c"># all arguments are mutually exclusive</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">first</span><span class="p">(</span><span class="n">add_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">add</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">handle_tab_completion</span><span class="p">(</span>
            <span class="n">needle</span><span class="o">=</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">sanitize</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">),</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">])),</span>
            <span class="n">entries</span><span class="o">=</span><span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">decrease</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">decrease_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">get_pwd</span><span class="p">(),</span> <span class="n">args</span><span class="o">.</span><span class="n">decrease</span><span class="p">)</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">increase</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">add_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">get_pwd</span><span class="p">(),</span> <span class="n">args</span><span class="o">.</span><span class="n">increase</span><span class="p">)</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">purge</span><span class="p">:</span>
        <span class="n">old_data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">dictify</span><span class="p">(</span><span class="n">purge_missing_paths</span><span class="p">(</span><span class="n">entriefy</span><span class="p">(</span><span class="n">old_data</span><span class="p">)))</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Purged </span><span class="si">%d</span><span class="s"> entries.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_data</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_data</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">stat</span><span class="p">:</span>
        <span class="n">print_stats</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
        <span class="c"># Return best match.</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">print_local</span><span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">imap</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">),</span> <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">])),</span>
            <span class="c"># always return a path to calling shell functions</span>
            <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">])))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">needles</span> <span class="o">=</span> <span class="n">sanitize</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">tab_needle</span><span class="p">,</span> <span class="n">tab_index</span><span class="p">,</span> <span class="n">tab_path</span> <span class="o">=</span> \
            <span class="n">get_tab_entry_info</span><span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">needles</span><span class="p">),</span> <span class="n">TAB_SEPARATOR</span><span class="p">)</span>

        <span class="c"># Handle `j foo__`, assuming first index.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tab_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tab_index</span> \
                <span class="ow">and</span> <span class="n">tab_needle</span> <span class="ow">and</span> <span class="n">needles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tab_needle</span> <span class="o">+</span> <span class="n">TAB_SEPARATOR</span><span class="p">:</span>
            <span class="n">tab_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tab_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">tab_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tab_index</span><span class="p">:</span>
            <span class="n">get_ith_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">take</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">))</span><span class="o">.</span><span class="n">path</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">get_ith_path</span><span class="p">(</span>
                    <span class="n">tab_index</span><span class="p">,</span>
                    <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">tab_needle</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
                <span class="n">imap</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">),</span> <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">needles</span><span class="p">)),</span>
                <span class="c"># always return a path to calling shell functions</span>
                <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">])))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">parse_arguments</span><span class="p">()))</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="smashlib.contrib.autojump.BACKUP_THRESHOLD" class="name">var <span class="ident">BACKUP_THRESHOLD</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.FUZZY_MATCH_THRESHOLD" class="name">var <span class="ident">FUZZY_MATCH_THRESHOLD</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.ONE_OR_MORE" class="name">var <span class="ident">ONE_OR_MORE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.OPTIONAL" class="name">var <span class="ident">OPTIONAL</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.PARSER" class="name">var <span class="ident">PARSER</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.REMAINDER" class="name">var <span class="ident">REMAINDER</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.SMASH_DIR" class="name">var <span class="ident">SMASH_DIR</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.SUPPRESS" class="name">var <span class="ident">SUPPRESS</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.TAB_ENTRIES_COUNT" class="name">var <span class="ident">TAB_ENTRIES_COUNT</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.TAB_SEPARATOR" class="name">var <span class="ident">TAB_SEPARATOR</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.VERSION" class="name">var <span class="ident">VERSION</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="smashlib.contrib.autojump.ZERO_OR_MORE" class="name">var <span class="ident">ZERO_OR_MORE</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.add_path">
    <p>def <span class="ident">add_path</span>(</p><p>data, path, weight=10)</p>
    </div>
    

    
  
    <div class="desc"><p>Add a new path or increment an existing one.</p>
<p>os.path.realpath() is not used because it's preferable to use symlinks
with resulting duplicate entries in the database than a single canonical
path.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.add_path', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.add_path" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a new path or increment an existing one.</span>

<span class="sd">    os.path.realpath() is not used because it&#39;s preferable to use symlinks</span>
<span class="sd">    with resulting duplicate entries in the database than a single canonical</span>
<span class="sd">    path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">unico</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">weight</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.create_dir">
    <p>def <span class="ident">create_dir</span>(</p><p>path)</p>
    </div>
    

    
  
    <div class="desc"><p>Creates a directory atomically.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.create_dir', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.create_dir" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_dir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a directory atomically.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exception</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
            <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.decrease_path">
    <p>def <span class="ident">decrease_path</span>(</p><p>data, path, weight=15)</p>
    </div>
    

    
  
    <div class="desc"><p>Decrease or zero out a path.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.decrease_path', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.decrease_path" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">decrease_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decrease or zero out a path.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">unico</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">path</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.detect_smartcase">
    <p>def <span class="ident">detect_smartcase</span>(</p><p>needles)</p>
    </div>
    

    
  
    <div class="desc"><p>If any needles contain an uppercase letter then use case sensitive
searching. Otherwise use case insensitive searching.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.detect_smartcase', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.detect_smartcase" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">detect_smartcase</span><span class="p">(</span><span class="n">needles</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If any needles contain an uppercase letter then use case sensitive</span>
<span class="sd">    searching. Otherwise use case insensitive searching.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">imap</span><span class="p">(</span><span class="n">has_uppercase</span><span class="p">,</span> <span class="n">needles</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.dictify">
    <p>def <span class="ident">dictify</span>(</p><p>entries)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts a list of entries into a dictionary where
key = path
value = weight</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.dictify', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.dictify" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">dictify</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a list of entries into a dictionary where</span>
<span class="sd">        key = path</span>
<span class="sd">        value = weight</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">weight</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.encode_local">
    <p>def <span class="ident">encode_local</span>(</p><p>string)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts string into user's preferred encoding.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.encode_local', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.encode_local" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">encode_local</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts string into user&#39;s preferred encoding.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">string</span>
    <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.entriefy">
    <p>def <span class="ident">entriefy</span>(</p><p>data)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts a dictionary into an iterator of entries.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.entriefy', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.entriefy" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">entriefy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a dictionary into an iterator of entries.&quot;&quot;&quot;</span>
    <span class="n">convert</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">Entry</span><span class="p">(</span><span class="o">*</span><span class="n">tup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">imap</span><span class="p">(</span><span class="n">convert</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.find_matches">
    <p>def <span class="ident">find_matches</span>(</p><p>entries, needles, check_entries=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Return an iterator to matching entries.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.find_matches', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.find_matches" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">needles</span><span class="p">,</span> <span class="n">check_entries</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an iterator to matching entries.&quot;&quot;&quot;</span>
    <span class="c"># TODO(wting|2014-02-24): replace assertion with unit test</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s">&quot;Needles must be a list.&quot;</span>
    <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">detect_smartcase</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># using closure to prevent constantly hitting hdd</span>
    <span class="k">def</span> <span class="nf">is_cwd</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">pwd</span>

    <span class="k">if</span> <span class="n">check_entries</span><span class="p">:</span>
        <span class="n">path_exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path_exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="bp">True</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">entries</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">),</span>
        <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="ow">not</span> <span class="n">is_cwd</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="ow">and</span> <span class="n">path_exists</span><span class="p">(</span><span class="n">entry</span><span class="p">),</span>
        <span class="n">chain</span><span class="p">(</span>
            <span class="n">match_consecutive</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">),</span>
            <span class="n">match_fuzzy</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">),</span>
            <span class="n">match_anywhere</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ignore_case</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.first">
    <p>def <span class="ident">first</span>(</p><p>xs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.first', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.first" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.get_pwd">
    <p>def <span class="ident">get_pwd</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.get_pwd', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.get_pwd" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_pwd</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Current directory no longer exists.&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.get_tab_entry_info">
    <p>def <span class="ident">get_tab_entry_info</span>(</p><p>entry, separator)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a tab entry in the following format return needle, index, and path:</p>
<p>[needle]<strong>[index]</strong>[path]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.get_tab_entry_info', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.get_tab_entry_info" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_tab_entry_info</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tab entry in the following format return needle, index, and path:</span>

<span class="sd">        [needle]__[index]__[path]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">needle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="n">match_needle</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;(.*?)&#39;</span> <span class="o">+</span> <span class="n">separator</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">match_index</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;([0-9]{1})&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
    <span class="n">match_path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;[0-9]{1}&#39;</span> <span class="o">+</span> <span class="n">separator</span> <span class="o">+</span> <span class="s">r&#39;(.*)&#39;</span><span class="p">,</span>
        <span class="n">entry</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match_needle</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">match_needle</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">match_index</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_index</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">match_path</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">match_path</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">needle</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">path</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.handle_tab_completion">
    <p>def <span class="ident">handle_tab_completion</span>(</p><p>needle, entries)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.handle_tab_completion', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.handle_tab_completion" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">handle_tab_completion</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
    <span class="n">tab_needle</span><span class="p">,</span> <span class="n">tab_index</span><span class="p">,</span> <span class="n">tab_path</span> <span class="o">=</span> <span class="n">get_tab_entry_info</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">TAB_SEPARATOR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tab_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tab_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">tab_index</span><span class="p">:</span>
        <span class="n">get_ith_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">take</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">))</span><span class="o">.</span><span class="n">path</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">get_ith_path</span><span class="p">(</span>
            <span class="n">tab_index</span><span class="p">,</span>
            <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">tab_needle</span><span class="p">],</span> <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">tab_needle</span><span class="p">:</span>
        <span class="c"># found partial tab completion entry</span>
        <span class="k">return</span> <span class="n">tab_menu</span><span class="p">(</span>
            <span class="n">tab_needle</span><span class="p">,</span>
            <span class="n">take</span><span class="p">(</span><span class="n">TAB_ENTRIES_COUNT</span><span class="p">,</span> <span class="n">find_matches</span><span class="p">(</span>
                <span class="n">entries</span><span class="p">,</span>
                <span class="p">[</span><span class="n">tab_needle</span><span class="p">],</span>
                <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
            <span class="n">TAB_SEPARATOR</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tab_menu</span><span class="p">(</span>
            <span class="n">needle</span><span class="p">,</span>
            <span class="n">take</span><span class="p">(</span><span class="n">TAB_ENTRIES_COUNT</span><span class="p">,</span> <span class="n">find_matches</span><span class="p">(</span>
                <span class="n">entries</span><span class="p">,</span>
                <span class="p">[</span><span class="n">needle</span><span class="p">],</span>
                <span class="n">check_entries</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
            <span class="n">TAB_SEPARATOR</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.has_uppercase">
    <p>def <span class="ident">has_uppercase</span>(</p><p>string)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.has_uppercase', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.has_uppercase" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">has_uppercase</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Lu&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.in_bash">
    <p>def <span class="ident">in_bash</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.in_bash', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.in_bash" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">in_bash</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;bash&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;SHELL&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_autojump_sourced">
    <p>def <span class="ident">is_autojump_sourced</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_autojump_sourced', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_autojump_sourced" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_autojump_sourced</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;1&#39;</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;AUTOJUMP_SOURCED&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_linux">
    <p>def <span class="ident">is_linux</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_linux', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_linux" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_linux</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Linux&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_osx">
    <p>def <span class="ident">is_osx</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_osx', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_osx" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_osx</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Darwin&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_python2">
    <p>def <span class="ident">is_python2</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_python2', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_python2" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_python2</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_python3">
    <p>def <span class="ident">is_python3</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_python3', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_python3" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_python3</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.is_windows">
    <p>def <span class="ident">is_windows</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.is_windows', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.is_windows" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">is_windows</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Windows&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.last">
    <p>def <span class="ident">last</span>(</p><p>xs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.last', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.last" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">__next__</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tmp</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.load">
    <p>def <span class="ident">load</span>(</p><p>config)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a dictonary (key=path, value=weight) loaded from data file.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.load', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.load" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a dictonary (key=path, value=weight) loaded from data file.&quot;&quot;&quot;</span>
    <span class="n">xdg_aj_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span>
        <span class="s">&#39;.local&#39;</span><span class="p">,</span>
        <span class="s">&#39;share&#39;</span><span class="p">,</span>
        <span class="s">&#39;autojump&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_osx</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">):</span>
        <span class="n">migrate_osx_xdg_data</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c"># example: u&#39;10.0\t/home/user\n&#39; -&gt; [&#39;10.0&#39;, u&#39;/home/user&#39;]</span>
    <span class="n">parse</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">correct_length</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="c"># example: [&#39;10.0&#39;, u&#39;/home/user&#39;] -&gt; (u&#39;/home/user&#39;, 10.0)</span>
    <span class="n">tupleize</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">],</span>
                <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">imap</span><span class="p">(</span>
                    <span class="n">tupleize</span><span class="p">,</span>
                    <span class="n">ifilter</span><span class="p">(</span><span class="n">correct_length</span><span class="p">,</span> <span class="n">imap</span><span class="p">(</span><span class="n">parse</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">load_backup</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.load_backup">
    <p>def <span class="ident">load_backup</span>(</p><p>config)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.load_backup', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.load_backup" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">load_backup</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">]):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{}</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.main">
    <p>def <span class="ident">main</span>(</p><p>args)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.main', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.main" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>  <span class="c"># noqa</span>
    <span class="c">#if not is_autojump_sourced() and not is_windows():</span>
    <span class="c">#    print(&quot;Please source the correct autojump file in your shell&#39;s&quot;)</span>
    <span class="c">#    print(&quot;startup file. For more information, please reinstall autojump&quot;)</span>
    <span class="c">#    print(&quot;and read the post installation instructions.&quot;)</span>
    <span class="c">#    return 1</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">set_defaults</span><span class="p">()</span>

    <span class="c"># all arguments are mutually exclusive</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">add</span><span class="p">:</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">first</span><span class="p">(</span><span class="n">add_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">args</span><span class="o">.</span><span class="n">add</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">complete</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">handle_tab_completion</span><span class="p">(</span>
            <span class="n">needle</span><span class="o">=</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">sanitize</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">),</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">])),</span>
            <span class="n">entries</span><span class="o">=</span><span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">decrease</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">decrease_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">get_pwd</span><span class="p">(),</span> <span class="n">args</span><span class="o">.</span><span class="n">decrease</span><span class="p">)</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">increase</span><span class="p">:</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">add_path</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">get_pwd</span><span class="p">(),</span> <span class="n">args</span><span class="o">.</span><span class="n">increase</span><span class="p">)</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">purge</span><span class="p">:</span>
        <span class="n">old_data</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">dictify</span><span class="p">(</span><span class="n">purge_missing_paths</span><span class="p">(</span><span class="n">entriefy</span><span class="p">(</span><span class="n">old_data</span><span class="p">)))</span>
        <span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Purged </span><span class="si">%d</span><span class="s"> entries.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_data</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_data</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">stat</span><span class="p">:</span>
        <span class="n">print_stats</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">),</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
        <span class="c"># Return best match.</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">print_local</span><span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
            <span class="n">imap</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">),</span> <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">])),</span>
            <span class="c"># always return a path to calling shell functions</span>
            <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">])))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entriefy</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
        <span class="n">needles</span> <span class="o">=</span> <span class="n">sanitize</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">tab_needle</span><span class="p">,</span> <span class="n">tab_index</span><span class="p">,</span> <span class="n">tab_path</span> <span class="o">=</span> \
            <span class="n">get_tab_entry_info</span><span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">needles</span><span class="p">),</span> <span class="n">TAB_SEPARATOR</span><span class="p">)</span>

        <span class="c"># Handle `j foo__`, assuming first index.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tab_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tab_index</span> \
                <span class="ow">and</span> <span class="n">tab_needle</span> <span class="ow">and</span> <span class="n">needles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tab_needle</span> <span class="o">+</span> <span class="n">TAB_SEPARATOR</span><span class="p">:</span>
            <span class="n">tab_index</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tab_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">tab_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tab_index</span><span class="p">:</span>
            <span class="n">get_ith_path</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">take</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">iterable</span><span class="p">))</span><span class="o">.</span><span class="n">path</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">get_ith_path</span><span class="p">(</span>
                    <span class="n">tab_index</span><span class="p">,</span>
                    <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="p">[</span><span class="n">tab_needle</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span>
                <span class="n">imap</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;path&#39;</span><span class="p">),</span> <span class="n">find_matches</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">needles</span><span class="p">)),</span>
                <span class="c"># always return a path to calling shell functions</span>
                <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.match_anywhere">
    <p>def <span class="ident">match_anywhere</span>(</p><p>needles, haystack, ignore_case=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Matches needles anywhere in the path as long as they're in the same (but
not necessary consecutive) order.</p>
<p>For example:
    needles = ['foo', 'baz']
    regex needle = r'.<em>foo.</em>baz.*'
    haystack = [
        (path="/foo/bar/baz", weight=10),
        (path="/baz/foo/bar", weight=10),
        (path="/foo/baz", weight=10)]</p>
<div class="codehilite"><pre>result = [
    (path=&quot;/moo/foo/baz&quot;, weight=10),
    (path=&quot;/foo/baz&quot;, weight=10)]
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.match_anywhere', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.match_anywhere" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">match_anywhere</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches needles anywhere in the path as long as they&#39;re in the same (but</span>
<span class="sd">    not necessary consecutive) order.</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;baz&#39;]</span>
<span class="sd">        regex needle = r&#39;.*foo.*baz.*&#39;</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/baz/foo/bar&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>

<span class="sd">        result = [</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">regex_needle</span> <span class="o">=</span> <span class="s">&#39;.*&#39;</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span>
    <span class="n">regex_flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span> <span class="k">if</span> <span class="n">ignore_case</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span>
    <span class="n">found</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">haystack</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regex_needle</span><span class="p">,</span>
        <span class="n">haystack</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">regex_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.match_consecutive">
    <p>def <span class="ident">match_consecutive</span>(</p><p>needles, haystack, ignore_case=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Matches consecutive needles at the end of a path.</p>
<p>For example:
    needles = ['foo', 'baz']
    haystack = [
        (path="/foo/bar/baz", weight=10),
        (path="/foo/baz/moo", weight=10),
        (path="/moo/foo/baz", weight=10),
        (path="/foo/baz", weight=10)]</p>
<div class="codehilite"><pre>regex_needle = re.compile(r&#39;&#39;&#39;
    foo     # needle #1
    [^/]*   # all characters except os.sep zero or more times
    /       # os.sep
    [^/]*   # all characters except os.sep zero or more times
    baz     # needle #2
    [^/]*   # all characters except os.sep zero or more times
    $       # end of string
    &#39;&#39;&#39;)

result = [
    (path=&quot;/moo/foo/baz&quot;, weight=10),
    (path=&quot;/foo/baz&quot;, weight=10)]
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.match_consecutive', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.match_consecutive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">match_consecutive</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches consecutive needles at the end of a path.</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;baz&#39;]</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz/moo&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>

<span class="sd">        regex_needle = re.compile(r&#39;&#39;&#39;</span>
<span class="sd">            foo     # needle #1</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            /       # os.sep</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            baz     # needle #2</span>
<span class="sd">            [^/]*   # all characters except os.sep zero or more times</span>
<span class="sd">            $       # end of string</span>
<span class="sd">            &#39;&#39;&#39;)</span>

<span class="sd">        result = [</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10)]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># The normal \\ separator needs to be escaped again for use in regex.</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">is_windows</span><span class="p">()</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">regex_no_sep</span> <span class="o">=</span> <span class="s">&#39;[^&#39;</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;]*&#39;</span>
    <span class="n">regex_no_sep_end</span> <span class="o">=</span> <span class="n">regex_no_sep</span> <span class="o">+</span> <span class="s">&#39;$&#39;</span>
    <span class="n">regex_one_sep</span> <span class="o">=</span> <span class="n">regex_no_sep</span> <span class="o">+</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">regex_no_sep</span>
    <span class="c"># can&#39;t use compiled regex because of flags</span>
    <span class="n">regex_needle</span> <span class="o">=</span> <span class="n">regex_one_sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">regex_no_sep_end</span>  <span class="c"># noqa</span>
    <span class="n">regex_flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span> <span class="k">if</span> <span class="n">ignore_case</span> <span class="k">else</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span>
    <span class="n">found</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">regex_needle</span><span class="p">,</span>
        <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">regex_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.match_fuzzy">
    <p>def <span class="ident">match_fuzzy</span>(</p><p>needles, haystack, ignore_case=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Performs an approximate match with the last needle against the end of
every path past an acceptable threshold (FUZZY_MATCH_THRESHOLD).</p>
<p>For example:
    needles = ['foo', 'bar']
    haystack = [
        (path="/foo/bar/baz", weight=11),
        (path="/foo/baz/moo", weight=10),
        (path="/moo/foo/baz", weight=10),
        (path="/foo/baz", weight=10),
        (path="/foo/bar", weight=10)]</p>
<p>result = [
        (path="/foo/bar/baz", weight=11),
        (path="/moo/foo/baz", weight=10),
        (path="/foo/baz", weight=10),
        (path="/foo/bar", weight=10)]</p>
<p>This is a weak heuristic and used as a last resort to find matches.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.match_fuzzy', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.match_fuzzy" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">match_fuzzy</span><span class="p">(</span><span class="n">needles</span><span class="p">,</span> <span class="n">haystack</span><span class="p">,</span> <span class="n">ignore_case</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an approximate match with the last needle against the end of</span>
<span class="sd">    every path past an acceptable threshold (FUZZY_MATCH_THRESHOLD).</span>

<span class="sd">    For example:</span>
<span class="sd">        needles = [&#39;foo&#39;, &#39;bar&#39;]</span>
<span class="sd">        haystack = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=11),</span>
<span class="sd">            (path=&quot;/foo/baz/moo&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/bar&quot;, weight=10)]</span>

<span class="sd">    result = [</span>
<span class="sd">            (path=&quot;/foo/bar/baz&quot;, weight=11),</span>
<span class="sd">            (path=&quot;/moo/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/baz&quot;, weight=10),</span>
<span class="sd">            (path=&quot;/foo/bar&quot;, weight=10)]</span>

<span class="sd">    This is a weak heuristic and used as a last resort to find matches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">end_dir</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">path</span><span class="p">:</span> <span class="n">last</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ignore_case</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">last</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">match_percent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">SequenceMatcher</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="n">needle</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">end_dir</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="n">last</span><span class="p">(</span><span class="n">needles</span><span class="p">)</span>
        <span class="n">match_percent</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">SequenceMatcher</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="n">needle</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">end_dir</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
    <span class="n">meets_threshold</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">match_percent</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">&gt;=</span> \
        <span class="n">FUZZY_MATCH_THRESHOLD</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">meets_threshold</span><span class="p">,</span> <span class="n">haystack</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.migrate_osx_xdg_data">
    <p>def <span class="ident">migrate_osx_xdg_data</span>(</p><p>config)</p>
    </div>
    

    
  
    <div class="desc"><p>Older versions incorrectly used Linux XDG_DATA_HOME paths on OS X. This
migrates autojump files from ~/.local/share/autojump to ~/Library/autojump</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.migrate_osx_xdg_data', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.migrate_osx_xdg_data" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">migrate_osx_xdg_data</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Older versions incorrectly used Linux XDG_DATA_HOME paths on OS X. This</span>
<span class="sd">    migrates autojump files from ~/.local/share/autojump to ~/Library/autojump</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_osx</span><span class="p">(),</span> <span class="s">&quot;This function should only be run on OS X.&quot;</span>

    <span class="n">xdg_data_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">),</span> <span class="s">&#39;.local&#39;</span><span class="p">,</span> <span class="s">&#39;share&#39;</span><span class="p">)</span>
    <span class="n">xdg_aj_home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">,</span> <span class="s">&#39;autojump&#39;</span><span class="p">)</span>
    <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt&#39;</span><span class="p">)</span>
    <span class="n">backup_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt.bak&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">backup_path</span><span class="p">):</span>
        <span class="n">move_file</span><span class="p">(</span><span class="n">backup_path</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span>

    <span class="c"># cleanup</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">xdg_aj_home</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">xdg_data_home</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.move_file">
    <p>def <span class="ident">move_file</span>(</p><p>src, dst)</p>
    </div>
    

    
  
    <div class="desc"><p>Atomically move file.</p>
<p>Windows does not allow for atomic file renaming (which is used by
os.rename / shutil.move) so destination paths must first be deleted.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.move_file', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.move_file" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">move_file</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Atomically move file.</span>

<span class="sd">    Windows does not allow for atomic file renaming (which is used by</span>
<span class="sd">    os.rename / shutil.move) so destination paths must first be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_windows</span><span class="p">()</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
        <span class="c"># raises exception if file is in use on Windows</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.parse_arguments">
    <p>def <span class="ident">parse_arguments</span>(</p><p>**kargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.parse_arguments', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.parse_arguments" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parse_arguments</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s">&#39;Automatically jump to directory passed as an argument.&#39;</span><span class="p">,</span>
        <span class="n">epilog</span><span class="o">=</span><span class="s">&quot;Please see autojump(1) man pages for full documentation.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;directory&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;DIRECTORY&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;directory to jump to&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-a&#39;</span><span class="p">,</span> <span class="s">&#39;--add&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;DIRECTORY&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;add path&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-i&#39;</span><span class="p">,</span> <span class="s">&#39;--increase&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;WEIGHT&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;increase current directory weight&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--decrease&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;WEIGHT&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;decrease current directory weight&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--complete&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;used for tab completion&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--purge&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;remove non-existent paths from database&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-s&#39;</span><span class="p">,</span> <span class="s">&#39;--stat&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;show database entries and their key weights&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%(prog)s</span><span class="s"> v&quot;</span> <span class="o">+</span>
        <span class="n">VERSION</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;show version information&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.print_entry">
    <p>def <span class="ident">print_entry</span>(</p><p>entry)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.print_entry', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.print_entry" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_entry</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="n">print_local</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.1f</span><span class="s">:</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.print_local">
    <p>def <span class="ident">print_local</span>(</p><p>string)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.print_local', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.print_local" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_local</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">encode_local</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.print_stats">
    <p>def <span class="ident">print_stats</span>(</p><p>data, data_path)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.print_stats', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.print_stats" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_path</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">print_entry</span><span class="p">(</span><span class="n">Entry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;________________________________________</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="se">\t</span><span class="s"> total weight&quot;</span> <span class="o">%</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="se">\t</span><span class="s"> number of entries&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">print_local</span><span class="p">(</span>
            <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">:</span><span class="se">\t</span><span class="s"> current directory weight&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwdu</span><span class="p">(),</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c"># current directory no longer exists</span>
        <span class="k">pass</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">data:</span><span class="se">\t</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">data_path</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.purge_missing_paths">
    <p>def <span class="ident">purge_missing_paths</span>(</p><p>entries)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove non-existent paths from a list of entries.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.purge_missing_paths', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.purge_missing_paths" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">purge_missing_paths</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove non-existent paths from a list of entries.&quot;&quot;&quot;</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ifilter</span><span class="p">(</span><span class="n">exists</span><span class="p">,</span> <span class="n">entries</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.sanitize">
    <p>def <span class="ident">sanitize</span>(</p><p>directories)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.sanitize', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.sanitize" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">sanitize</span><span class="p">(</span><span class="n">directories</span><span class="p">):</span>
    <span class="c"># edge case to allow &#39;/&#39; as a valid path</span>
    <span class="n">clean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">unico</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="k">else</span> <span class="n">unico</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">imap</span><span class="p">(</span><span class="n">clean</span><span class="p">,</span> <span class="n">directories</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.save">
    <p>def <span class="ident">save</span>(</p><p>config, data)</p>
    </div>
    

    
  
    <div class="desc"><p>Save data and create backup, creating a new data file if necessary.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.save', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.save" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save data and create backup, creating a new data file if necessary.&quot;&quot;&quot;</span>
    <span class="n">create_dir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]))</span>

    <span class="c"># atomically save by writing to temporary file and moving to destination</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># Windows cannot reuse the same open file name</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unico</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">path</span><span class="p">)))</span>

            <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Error saving autojump data (disk full?)&quot;</span> <span class="o">%</span> <span class="n">ex</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># move temp_file -&gt; autojump.txt</span>
    <span class="n">move_file</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">])</span>

    <span class="c"># create backup file if it doesn&#39;t exist or is older than BACKUP_THRESHOLD</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span> <span class="ow">or</span> \
            <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">BACKUP_THRESHOLD</span><span class="p">):</span>  <span class="c"># noqa</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.second">
    <p>def <span class="ident">second</span>(</p><p>xs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.second', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.second" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_python2</span><span class="p">():</span>
            <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">is_python3</span><span class="p">():</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.set_defaults">
    <p>def <span class="ident">set_defaults</span>(</p><p>)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.set_defaults', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.set_defaults" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">set_defaults</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">data_home</span><span class="o">=</span><span class="n">SMASH_DIR</span>
    <span class="n">config</span><span class="p">[</span><span class="s">&#39;data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt&#39;</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s">&#39;backup_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_home</span><span class="p">,</span> <span class="s">&#39;autojump.txt.bak&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.surround_quotes">
    <p>def <span class="ident">surround_quotes</span>(</p><p>string)</p>
    </div>
    

    
  
    <div class="desc"><p>Bash has problems dealing with certain paths so we're surrounding all
path outputs with quotes.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.surround_quotes', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.surround_quotes" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">surround_quotes</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bash has problems dealing with certain paths so we&#39;re surrounding all</span>
<span class="sd">    path outputs with quotes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">in_bash</span><span class="p">()</span> <span class="ow">and</span> <span class="n">string</span><span class="p">:</span>
        <span class="c"># Python 2.6 requres field numbers</span>
        <span class="k">return</span> <span class="s">&#39;&quot;{0}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.tab_menu">
    <p>def <span class="ident">tab_menu</span>(</p><p>needle, tab_entries, separator)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints the tab completion menu according to the following format:</p>
<div class="codehilite"><pre>[needle]__[index]__[possible_match]
</pre></div>


<p>The needle (search pattern) and index are necessary to recreate the results
on subsequent calls.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.tab_menu', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.tab_menu" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">tab_menu</span><span class="p">(</span><span class="n">needle</span><span class="p">,</span> <span class="n">tab_entries</span><span class="p">,</span> <span class="n">separator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the tab completion menu according to the following format:</span>

<span class="sd">        [needle]__[index]__[possible_match]</span>

<span class="sd">    The needle (search pattern) and index are necessary to recreate the results</span>
<span class="sd">    on subsequent calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab_entries</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_local</span><span class="p">(</span>
            <span class="s">&#39;</span><span class="si">%s%s%d%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">needle</span><span class="p">,</span>
                <span class="n">separator</span><span class="p">,</span>
                <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">separator</span><span class="p">,</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.take">
    <p>def <span class="ident">take</span>(</p><p>n, iterable)</p>
    </div>
    

    
  
    <div class="desc"><p>Return first n items of an iterable.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.take', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.take" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">take</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return first n items of an iterable.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">islice</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.unico">
    <p>def <span class="ident">unico</span>(</p><p>string)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts into Unicode string.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.unico', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.unico" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">unico</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts into Unicode string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_python2</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s">&#39;replace&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">string</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.Action" class="name">class <span class="ident">Action</span></p>
      
  
    <div class="desc"><p>Information about how to convert command line strings to Python objects.</p>
<p>Action objects are used by an ArgumentParser to represent the information
needed to parse a single argument from one or more strings from the
command line. The keyword arguments to the Action constructor are also
all attributes of Action instances.</p>
<p>Keyword Arguments:</p>
<div class="codehilite"><pre>- option_strings -- A list of command-line option strings which
    should be associated with this action.

- dest -- The name of the attribute to hold the created object(s)

- nargs -- The number of command-line arguments that should be
    consumed. By default, one argument will be consumed and a single
    value will be produced.  Other values include:
        - N (an integer) consumes N arguments (and produces a list)
        - &#39;?&#39; consumes zero or one arguments
        - &#39;*&#39; consumes zero or more arguments (and produces a list)
        - &#39;+&#39; consumes one or more arguments (and produces a list)
    Note that the difference between the default and nargs=1 is that
    with the default, a single value will be produced, while with
    nargs=1, a list containing a single value will be produced.

- const -- The value to be produced if the option is specified and the
    option uses an action that takes no values.

- default -- The value to be produced if the option is not specified.

- type -- The type which the command-line arguments should be converted
    to, should be one of &#39;string&#39;, &#39;int&#39;, &#39;float&#39;, &#39;complex&#39; or a
    callable object that accepts a single string argument. If None,
    &#39;string&#39; is assumed.

- choices -- A container of values that should be allowed. If not None,
    after a command-line argument has been converted to the appropriate
    type, an exception will be raised if it is not a member of this
    collection.

- required -- True if the action must always be specified at the
    command line. This is only meaningful for optional command-line
    arguments.

- help -- The help string describing the argument.

- metavar -- The name to be used for the option&#39;s argument with the
    help string. If None, the &#39;dest&#39; value will be used as the name.
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.Action', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.Action" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Action</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Information about how to convert command line strings to Python objects.</span>

<span class="sd">    Action objects are used by an ArgumentParser to represent the information</span>
<span class="sd">    needed to parse a single argument from one or more strings from the</span>
<span class="sd">    command line. The keyword arguments to the Action constructor are also</span>
<span class="sd">    all attributes of Action instances.</span>

<span class="sd">    Keyword Arguments:</span>

<span class="sd">        - option_strings -- A list of command-line option strings which</span>
<span class="sd">            should be associated with this action.</span>

<span class="sd">        - dest -- The name of the attribute to hold the created object(s)</span>

<span class="sd">        - nargs -- The number of command-line arguments that should be</span>
<span class="sd">            consumed. By default, one argument will be consumed and a single</span>
<span class="sd">            value will be produced.  Other values include:</span>
<span class="sd">                - N (an integer) consumes N arguments (and produces a list)</span>
<span class="sd">                - &#39;?&#39; consumes zero or one arguments</span>
<span class="sd">                - &#39;*&#39; consumes zero or more arguments (and produces a list)</span>
<span class="sd">                - &#39;+&#39; consumes one or more arguments (and produces a list)</span>
<span class="sd">            Note that the difference between the default and nargs=1 is that</span>
<span class="sd">            with the default, a single value will be produced, while with</span>
<span class="sd">            nargs=1, a list containing a single value will be produced.</span>

<span class="sd">        - const -- The value to be produced if the option is specified and the</span>
<span class="sd">            option uses an action that takes no values.</span>

<span class="sd">        - default -- The value to be produced if the option is not specified.</span>

<span class="sd">        - type -- The type which the command-line arguments should be converted</span>
<span class="sd">            to, should be one of &#39;string&#39;, &#39;int&#39;, &#39;float&#39;, &#39;complex&#39; or a</span>
<span class="sd">            callable object that accepts a single string argument. If None,</span>
<span class="sd">            &#39;string&#39; is assumed.</span>

<span class="sd">        - choices -- A container of values that should be allowed. If not None,</span>
<span class="sd">            after a command-line argument has been converted to the appropriate</span>
<span class="sd">            type, an exception will be raised if it is not a member of this</span>
<span class="sd">            collection.</span>

<span class="sd">        - required -- True if the action must always be specified at the</span>
<span class="sd">            command line. This is only meaningful for optional command-line</span>
<span class="sd">            arguments.</span>

<span class="sd">        - help -- The help string describing the argument.</span>

<span class="sd">        - metavar -- The name to be used for the option&#39;s argument with the</span>
<span class="sd">            help string. If None, the &#39;dest&#39; value will be used as the name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span> <span class="o">=</span> <span class="n">option_strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="n">const</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metavar</span> <span class="o">=</span> <span class="n">metavar</span>

    <span class="k">def</span> <span class="nf">_get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;option_strings&#39;</span><span class="p">,</span>
            <span class="s">&#39;dest&#39;</span><span class="p">,</span>
            <span class="s">&#39;nargs&#39;</span><span class="p">,</span>
            <span class="s">&#39;const&#39;</span><span class="p">,</span>
            <span class="s">&#39;default&#39;</span><span class="p">,</span>
            <span class="s">&#39;type&#39;</span><span class="p">,</span>
            <span class="s">&#39;choices&#39;</span><span class="p">,</span>
            <span class="s">&#39;help&#39;</span><span class="p">,</span>
            <span class="s">&#39;metavar&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;.__call__() not defined&#39;</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.Action">Action</a></li>
          <li>smashlib.contrib.autojump._AttributeHolder</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.choices" class="name">var <span class="ident">choices</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.const" class="name">var <span class="ident">const</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.default" class="name">var <span class="ident">default</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.dest" class="name">var <span class="ident">dest</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.help" class="name">var <span class="ident">help</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.metavar" class="name">var <span class="ident">metavar</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.nargs" class="name">var <span class="ident">nargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.option_strings" class="name">var <span class="ident">option_strings</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.required" class="name">var <span class="ident">required</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Action.type" class="name">var <span class="ident">type</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.Action.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, option_strings, dest, nargs=None, const=None, default=None, type=None, choices=None, required=False, help=None, metavar=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.Action.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.Action.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">option_strings</span><span class="p">,</span>
             <span class="n">dest</span><span class="p">,</span>
             <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span> <span class="o">=</span> <span class="n">option_strings</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">=</span> <span class="n">nargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">const</span> <span class="o">=</span> <span class="n">const</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">help</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metavar</span> <span class="o">=</span> <span class="n">metavar</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter" class="name">class <span class="ident">ArgumentDefaultsHelpFormatter</span></p>
      
  
    <div class="desc"><p>Help message formatter which adds default values to argument help.</p>
<p>Only the name of this class is considered a public API. All the methods
provided by the class are considered an implementation detail.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ArgumentDefaultsHelpFormatter</span><span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which adds default values to argument help.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_help_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span>
        <span class="k">if</span> <span class="s">&#39;%(default)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">defaulting_nargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">,</span> <span class="n">ZERO_OR_MORE</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span> <span class="ow">or</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">in</span> <span class="n">defaulting_nargs</span><span class="p">:</span>
                    <span class="n">help</span> <span class="o">+=</span> <span class="s">&#39; (default: </span><span class="si">%(default)s</span><span class="s">)&#39;</span>
        <span class="k">return</span> <span class="n">help</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter">ArgumentDefaultsHelpFormatter</a></li>
          <li><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, prog, indent_increment=2, max_help_position=24, width=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">prog</span><span class="p">,</span>
             <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># default setting for width</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_argument">
    <p>def <span class="ident">add_argument</span>(</p><p>self, action)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_argument">add_argument</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_argument', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_argument" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="c"># find all invocations</span>
        <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
        <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>
        <span class="c"># update the maximum item length</span>
        <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
        <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                      <span class="n">action_length</span><span class="p">)</span>
        <span class="c"># add the item to the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_arguments">
    <p>def <span class="ident">add_arguments</span>(</p><p>self, actions)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_arguments">add_arguments</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_arguments', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_arguments" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_text">
    <p>def <span class="ident">add_text</span>(</p><p>self, text)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_text">add_text</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_text', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_text" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_usage">
    <p>def <span class="ident">add_usage</span>(</p><p>self, usage, actions, groups, prefix=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_usage">add_usage</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.add_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.end_section">
    <p>def <span class="ident">end_section</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.end_section">end_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.end_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.end_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.format_help">
    <p>def <span class="ident">format_help</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.format_help">format_help</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.format_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.format_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">help</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.start_section">
    <p>def <span class="ident">start_section</span>(</p><p>self, heading)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.start_section">start_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.start_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentDefaultsHelpFormatter.start_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
    <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.ArgumentError" class="name">class <span class="ident">ArgumentError</span></p>
      
  
    <div class="desc"><p>An error from creating or using an argument (optional or positional).</p>
<p>The string value of this exception is the message, augmented with
information about the argument that caused it.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentError', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentError" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ArgumentError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;An error from creating or using an argument (optional or positional).</span>

<span class="sd">    The string value of this exception is the message, augmented with</span>
<span class="sd">    information about the argument that caused it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;argument </span><span class="si">%(argument_name)s</span><span class="s">: </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="k">return</span> <span class="n">format</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                             <span class="n">argument_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.ArgumentError">ArgumentError</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentError.argument_name" class="name">var <span class="ident">argument_name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentError.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentError.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, argument, message)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentError.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentError.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">argument_name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.ArgumentParser" class="name">class <span class="ident">ArgumentParser</span></p>
      
  
    <div class="desc"><p>Object for parsing command line strings into Python objects.</p>
<p>Keyword Arguments:
    - prog -- The name of the program (default: sys.argv[0])
    - usage -- A usage message (default: auto-generated from arguments)
    - description -- A description of what the program does
    - epilog -- Text following the argument descriptions
    - parents -- Parsers whose arguments should be copied into this one
    - formatter_class -- HelpFormatter class for printing help messages
    - prefix_chars -- Characters that prefix optional arguments
    - fromfile_prefix_chars -- Characters that prefix files containing
        additional arguments
    - argument_default -- The default value for all arguments
    - conflict_handler -- String indicating how to handle conflicts
    - add_help -- Add a -h/-help option</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">,</span> <span class="n">_ActionsContainer</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Object for parsing command line strings into Python objects.</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        - prog -- The name of the program (default: sys.argv[0])</span>
<span class="sd">        - usage -- A usage message (default: auto-generated from arguments)</span>
<span class="sd">        - description -- A description of what the program does</span>
<span class="sd">        - epilog -- Text following the argument descriptions</span>
<span class="sd">        - parents -- Parsers whose arguments should be copied into this one</span>
<span class="sd">        - formatter_class -- HelpFormatter class for printing help messages</span>
<span class="sd">        - prefix_chars -- Characters that prefix optional arguments</span>
<span class="sd">        - fromfile_prefix_chars -- Characters that prefix files containing</span>
<span class="sd">            additional arguments</span>
<span class="sd">        - argument_default -- The default value for all arguments</span>
<span class="sd">        - conflict_handler -- String indicating how to handle conflicts</span>
<span class="sd">        - add_help -- Add a -h/-help option</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">prog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">usage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">epilog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">parents</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">formatter_class</span><span class="o">=</span><span class="n">HelpFormatter</span><span class="p">,</span>
                 <span class="n">prefix_chars</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span>
                 <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">argument_default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">conflict_handler</span><span class="o">=</span><span class="s">&#39;error&#39;</span><span class="p">,</span>
                 <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">warnings</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;The &quot;version&quot; argument to ArgumentParser is deprecated. &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;Please use &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;&quot;add_argument(..., action=&#39;version&#39;, version=&quot;N&quot;, ...)&quot; &quot;&quot;&quot;</span>
                <span class="sd">&quot;&quot;&quot;instead&quot;&quot;&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>

        <span class="n">superinit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArgumentParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span>
        <span class="n">superinit</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                  <span class="n">prefix_chars</span><span class="o">=</span><span class="n">prefix_chars</span><span class="p">,</span>
                  <span class="n">argument_default</span><span class="o">=</span><span class="n">argument_default</span><span class="p">,</span>
                  <span class="n">conflict_handler</span><span class="o">=</span><span class="n">conflict_handler</span><span class="p">)</span>

        <span class="c"># default setting for prog</span>
        <span class="k">if</span> <span class="n">prog</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epilog</span> <span class="o">=</span> <span class="n">epilog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter_class</span> <span class="o">=</span> <span class="n">formatter_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span> <span class="o">=</span> <span class="n">fromfile_prefix_chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span> <span class="o">=</span> <span class="n">add_help</span>

        <span class="n">add_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;positional arguments&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_optionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;optional arguments&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># register types</span>
        <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span>

        <span class="c"># add help and version arguments if necessary</span>
        <span class="c"># (using explicit default to override global argument_default)</span>
        <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">prefix_chars</span><span class="p">:</span>
            <span class="n">default_prefix</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default_prefix</span> <span class="o">=</span> <span class="n">prefix_chars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;help&#39;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;show this help message and exit&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;version&#39;</span><span class="p">,</span>
                <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;show program&#39;s version number and exit&quot;</span><span class="p">))</span>

        <span class="c"># add parent arguments and defaults</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_container_actions</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">defaults</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_defaults</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Pretty __repr__ methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">_get_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;prog&#39;</span><span class="p">,</span>
            <span class="s">&#39;usage&#39;</span><span class="p">,</span>
            <span class="s">&#39;description&#39;</span><span class="p">,</span>
            <span class="s">&#39;version&#39;</span><span class="p">,</span>
            <span class="s">&#39;formatter_class&#39;</span><span class="p">,</span>
            <span class="s">&#39;conflict_handler&#39;</span><span class="p">,</span>
            <span class="s">&#39;add_help&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

    <span class="c"># ==================================</span>
    <span class="c"># Optional/Positional adding methods</span>
    <span class="c"># ==================================</span>
    <span class="k">def</span> <span class="nf">add_subparsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;cannot have multiple subparser arguments&#39;</span><span class="p">))</span>

        <span class="c"># add the parser class to the arguments if it&#39;s not present</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;parser_class&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;subcommands&#39;</span><span class="p">))</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span>

        <span class="c"># prog defaults to the usage message of this parser, skipping</span>
        <span class="c"># optional arguments and with no &quot;usage:&quot; prefix</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prog&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
            <span class="n">positionals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_actions</span><span class="p">()</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># create the parsers action and add it to the positionals list</span>
        <span class="n">parsers_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_action_class</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s">&#39;parsers&#39;</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">parsers_class</span><span class="p">(</span><span class="n">option_strings</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c"># return the created parsers action</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_add_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_optionals</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_get_optional_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">action</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_positional_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">action</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">]</span>

    <span class="c"># =====================================</span>
    <span class="c"># Command line argument parsing methods</span>
    <span class="c"># =====================================</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">argv</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;unrecognized arguments: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># args default to the system args</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c"># default Namespace built from parser defaults</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>

        <span class="c"># add any action defaults that aren&#39;t present</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

        <span class="c"># add any parser defaults that aren&#39;t present</span>
        <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">])</span>

        <span class="c"># parse the arguments and exit if there are any errors</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">))</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span>
        <span class="k">except</span> <span class="n">ArgumentError</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="c"># replace arg strings that are file references</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">arg_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_args_from_files</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>

        <span class="c"># map all mutually exclusive arguments to the other arguments</span>
        <span class="c"># they can&#39;t occur with</span>
        <span class="n">action_conflicts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">mutex_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">:</span>
            <span class="n">group_actions</span> <span class="o">=</span> <span class="n">mutex_group</span><span class="o">.</span><span class="n">_group_actions</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutex_action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mutex_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">):</span>
                <span class="n">conflicts</span> <span class="o">=</span> <span class="n">action_conflicts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">mutex_action</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group_actions</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group_actions</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>

        <span class="c"># find all option indices, and determine the arg_string_pattern</span>
        <span class="c"># which has an &#39;O&#39; if there is an option at an index,</span>
        <span class="c"># an &#39;A&#39; if there is an argument, or a &#39;-&#39; if there is a &#39;--&#39;</span>
        <span class="n">option_string_indices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">arg_string_pattern_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arg_strings_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arg_strings_iter</span><span class="p">):</span>

            <span class="c"># all args after -- are non-options</span>
            <span class="k">if</span> <span class="n">arg_string</span> <span class="o">==</span> <span class="s">&#39;--&#39;</span><span class="p">:</span>
                <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="n">arg_strings_iter</span><span class="p">:</span>
                    <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span>

            <span class="c"># otherwise, add the arg to the arg strings</span>
            <span class="c"># and note the index if it was an option</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_optional</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">option_tuple</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">option_string_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_tuple</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;O&#39;</span>
                <span class="n">arg_string_pattern_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>

        <span class="c"># join the pieces together to form the pattern</span>
        <span class="n">arg_strings_pattern</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg_string_pattern_parts</span><span class="p">)</span>

        <span class="c"># converts arg strings to the appropriate and then takes the action</span>
        <span class="n">seen_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">seen_non_default_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">argument_strings</span><span class="p">,</span> <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">seen_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">argument_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">argument_strings</span><span class="p">)</span>

            <span class="c"># error if this argument is not allowed with other previously</span>
            <span class="c"># seen arguments, assuming that actions that use the default</span>
            <span class="c"># value don&#39;t really count as &quot;present&quot;</span>
            <span class="k">if</span> <span class="n">argument_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span><span class="p">:</span>
                <span class="n">seen_non_default_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">conflict_action</span> <span class="ow">in</span> <span class="n">action_conflicts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">conflict_action</span> <span class="ow">in</span> <span class="n">seen_non_default_actions</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;not allowed with argument </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">action_name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">conflict_action</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">action_name</span><span class="p">)</span>

            <span class="c"># take the action if we didn&#39;t receive a SUPPRESS value</span>
            <span class="c"># (e.g. from a default)</span>
            <span class="k">if</span> <span class="n">argument_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">argument_values</span><span class="p">,</span> <span class="n">option_string</span><span class="p">)</span>

        <span class="c"># function to convert arg_strings into an optional action</span>
        <span class="k">def</span> <span class="nf">consume_optional</span><span class="p">(</span><span class="n">start_index</span><span class="p">):</span>

            <span class="c"># get the optional identified at this index</span>
            <span class="n">option_tuple</span> <span class="o">=</span> <span class="n">option_string_indices</span><span class="p">[</span><span class="n">start_index</span><span class="p">]</span>
            <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">option_tuple</span>

            <span class="c"># identify additional optionals in the same arg string</span>
            <span class="c"># (e.g. -xyz is the same as -x -y -z if no args are required)</span>
            <span class="n">match_argument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_argument</span>
            <span class="n">action_tuples</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

                <span class="c"># if we found no optional action, skip it</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">extras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="c"># if there is an explicit argument, try to match the</span>
                <span class="c"># optional&#39;s string arguments to only this</span>
                <span class="k">if</span> <span class="n">explicit_arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">arg_count</span> <span class="o">=</span> <span class="n">match_argument</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>

                    <span class="c"># if the action is a single-dash option and takes no</span>
                    <span class="c"># arguments, try to parse more single-dash options out</span>
                    <span class="c"># of the tail of the option string</span>
                    <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
                    <span class="k">if</span> <span class="n">arg_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
                        <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="p">[],</span> <span class="n">option_string</span><span class="p">))</span>
                        <span class="n">char</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">option_string</span> <span class="o">=</span> <span class="n">char</span> <span class="o">+</span> <span class="n">explicit_arg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">new_explicit_arg</span> <span class="o">=</span> <span class="n">explicit_arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="bp">None</span>
                        <span class="n">optionals_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span>
                        <span class="k">if</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">optionals_map</span><span class="p">:</span>
                            <span class="n">action</span> <span class="o">=</span> <span class="n">optionals_map</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                            <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">new_explicit_arg</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;ignored explicit argument </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">explicit_arg</span><span class="p">)</span>

                    <span class="c"># if the action expect exactly one argument, we&#39;ve</span>
                    <span class="c"># successfully matched the option; exit the loop</span>
                    <span class="k">elif</span> <span class="n">arg_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">explicit_arg</span><span class="p">]</span>
                        <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">))</span>
                        <span class="k">break</span>

                    <span class="c"># error if a double-dash option did not use the</span>
                    <span class="c"># explicit argument</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;ignored explicit argument </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">explicit_arg</span><span class="p">)</span>

                <span class="c"># if there is no explicit argument, try to match the</span>
                <span class="c"># optional&#39;s string arguments with the following strings</span>
                <span class="c"># if successful, exit the loop</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">selected_patterns</span> <span class="o">=</span> <span class="n">arg_strings_pattern</span><span class="p">[</span><span class="n">start</span><span class="p">:]</span>
                    <span class="n">arg_count</span> <span class="o">=</span> <span class="n">match_argument</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">selected_patterns</span><span class="p">)</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">arg_count</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">action_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">))</span>
                    <span class="k">break</span>

            <span class="c"># add the Optional to the list and return the index at which</span>
            <span class="c"># the Optional&#39;s string args stopped</span>
            <span class="k">assert</span> <span class="n">action_tuples</span>
            <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action_tuples</span><span class="p">:</span>
                <span class="n">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">option_string</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">stop</span>

        <span class="c"># the list of Positionals left to be parsed; this is modified</span>
        <span class="c"># by consume_positionals()</span>
        <span class="n">positionals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_actions</span><span class="p">()</span>

        <span class="c"># function to convert arg_strings into positional actions</span>
        <span class="k">def</span> <span class="nf">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">):</span>
            <span class="c"># match as many Positionals as possible</span>
            <span class="n">match_partial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_arguments_partial</span>
            <span class="n">selected_pattern</span> <span class="o">=</span> <span class="n">arg_strings_pattern</span><span class="p">[</span><span class="n">start_index</span><span class="p">:]</span>
            <span class="n">arg_counts</span> <span class="o">=</span> <span class="n">match_partial</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">selected_pattern</span><span class="p">)</span>

            <span class="c"># slice off the appropriate arg strings for each Positional</span>
            <span class="c"># and add the Positional and its args to the list</span>
            <span class="k">for</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">arg_counts</span><span class="p">):</span>
                <span class="n">args</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">arg_count</span><span class="p">]</span>
                <span class="n">start_index</span> <span class="o">+=</span> <span class="n">arg_count</span>
                <span class="n">take_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

            <span class="c"># slice off the Positionals that we just parsed and return the</span>
            <span class="c"># index at which the Positionals&#39; string args stopped</span>
            <span class="n">positionals</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">positionals</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">arg_counts</span><span class="p">):]</span>
            <span class="k">return</span> <span class="n">start_index</span>

        <span class="c"># consume Positionals and Optionals alternately, until we have</span>
        <span class="c"># passed the last option string</span>
        <span class="n">extras</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">option_string_indices</span><span class="p">:</span>
            <span class="n">max_option_string_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">option_string_indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_option_string_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">start_index</span> <span class="o">&lt;=</span> <span class="n">max_option_string_index</span><span class="p">:</span>

            <span class="c"># consume any Positionals preceding the next option</span>
            <span class="n">next_option_string_index</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span>
                <span class="n">index</span>
                <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">option_string_indices</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">start_index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="o">!=</span> <span class="n">next_option_string_index</span><span class="p">:</span>
                <span class="n">positionals_end_index</span> <span class="o">=</span> <span class="n">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

                <span class="c"># only try to parse the next optional if we didn&#39;t consume</span>
                <span class="c"># the option string during the positionals parsing</span>
                <span class="k">if</span> <span class="n">positionals_end_index</span> <span class="o">&gt;</span> <span class="n">start_index</span><span class="p">:</span>
                    <span class="n">start_index</span> <span class="o">=</span> <span class="n">positionals_end_index</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">start_index</span> <span class="o">=</span> <span class="n">positionals_end_index</span>

            <span class="c"># if we consumed all the positionals we could and we&#39;re not</span>
            <span class="c"># at the index of an option string, there were extra arguments</span>
            <span class="k">if</span> <span class="n">start_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">option_string_indices</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="n">arg_strings</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">next_option_string_index</span><span class="p">]</span>
                <span class="n">extras</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">next_option_string_index</span>

            <span class="c"># consume the next optional and any arguments for it</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">consume_optional</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

        <span class="c"># consume any positionals following the last Optional</span>
        <span class="n">stop_index</span> <span class="o">=</span> <span class="n">consume_positionals</span><span class="p">(</span><span class="n">start_index</span><span class="p">)</span>

        <span class="c"># if we didn&#39;t consume all the argument strings, there were extras</span>
        <span class="n">extras</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">[</span><span class="n">stop_index</span><span class="p">:])</span>

        <span class="c"># if we didn&#39;t use all the Positional objects, there were too few</span>
        <span class="c"># arg strings supplied.</span>
        <span class="k">if</span> <span class="n">positionals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;too few arguments&#39;</span><span class="p">))</span>

        <span class="c"># make sure all required actions were present</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_actions</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">_get_action_name</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;argument </span><span class="si">%s</span><span class="s"> is required&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

        <span class="c"># make sure all required groups had one option present</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">seen_non_default_actions</span><span class="p">:</span>
                        <span class="k">break</span>

                <span class="c"># if no actions were used, report the error</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_action_name</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span>
                             <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">]</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;one of the arguments </span><span class="si">%s</span><span class="s"> is required&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>

        <span class="c"># return the updated namespace and the extra arguments</span>
        <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">extras</span>

    <span class="k">def</span> <span class="nf">_read_args_from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">):</span>
        <span class="c"># expand arguments referencing files</span>
        <span class="n">new_arg_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">:</span>

            <span class="c"># for regular arguments, just add them back into the list</span>
            <span class="k">if</span> <span class="n">arg_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span><span class="p">:</span>
                <span class="n">new_arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

            <span class="c"># replace arguments referencing files with the file content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">arg_string</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">arg_strings</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">arg_line</span> <span class="ow">in</span> <span class="n">args_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_arg_line_to_args</span><span class="p">(</span><span class="n">arg_line</span><span class="p">):</span>
                                <span class="n">arg_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                        <span class="n">arg_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_args_from_files</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
                        <span class="n">new_arg_strings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">args_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                    <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

        <span class="c"># return the modified argument list</span>
        <span class="k">return</span> <span class="n">new_arg_strings</span>

    <span class="k">def</span> <span class="nf">convert_arg_line_to_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_line</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">arg_line</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_match_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">):</span>
        <span class="c"># match the pattern for this action to the arg strings</span>
        <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nargs_pattern</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nargs_pattern</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">)</span>

        <span class="c"># raise an exception if we weren&#39;t able to find a match</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nargs_errors</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">None</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected one argument&#39;</span><span class="p">),</span>
                <span class="n">OPTIONAL</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected at most one argument&#39;</span><span class="p">),</span>
                <span class="n">ONE_OR_MORE</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected at least one argument&#39;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;expected </span><span class="si">%s</span><span class="s"> argument(s)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">nargs_errors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c"># return the number of arguments matched</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_match_arguments_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">):</span>
        <span class="c"># progressively shorten the actions list by slicing off the</span>
        <span class="c"># final actions until we find a match</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">actions_slice</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_nargs_pattern</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions_slice</span><span class="p">])</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">arg_strings_pattern</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()])</span>
                <span class="k">break</span>

        <span class="c"># return the list of arg string counts</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_parse_optional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">):</span>
        <span class="c"># if it&#39;s an empty string, it was meant to be a positional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if it doesn&#39;t start with a prefix, it was meant to be positional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if the option string is present in the parser, return the action</span>
        <span class="k">if</span> <span class="n">arg_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">arg_string</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">,</span> <span class="bp">None</span>

        <span class="c"># if it&#39;s just a single character, it was meant to be positional</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if the option string before the &quot;=&quot; is present, return the action</span>
        <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">arg_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>

        <span class="c"># search through all possible prefixes of the option string</span>
        <span class="c"># and all actions in the parser for possible interpretations</span>
        <span class="n">option_tuples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_option_tuples</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

        <span class="c"># if multiple actions match, the option string was ambiguous</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tuples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">ostring</span> <span class="k">for</span> <span class="n">oaction</span><span class="p">,</span> <span class="n">ostring</span><span class="p">,</span> <span class="n">earg</span> <span class="ow">in</span> <span class="n">option_tuples</span><span class="p">])</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="n">arg_string</span><span class="p">,</span> <span class="n">options</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;ambiguous option: </span><span class="si">%s</span><span class="s"> could match </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tup</span><span class="p">)</span>

        <span class="c"># if exactly one action matched, this segmentation is good,</span>
        <span class="c"># so return the parsed action</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">option_tuples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">option_tuple</span><span class="p">,</span> <span class="o">=</span> <span class="n">option_tuples</span>
            <span class="k">return</span> <span class="n">option_tuple</span>

        <span class="c"># if it was not found as an option, but it looks like a negative</span>
        <span class="c"># number, it was meant to be positional</span>
        <span class="c"># unless there are negative-number-like options</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_negative_number_matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">arg_string</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_negative_number_optionals</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># if it contains a space, it was meant to be a positional</span>
        <span class="k">if</span> <span class="s">&#39; &#39;</span> <span class="ow">in</span> <span class="n">arg_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># it was meant to be an optional but there is no such option</span>
        <span class="c"># in this parser (though it might be a valid option in a subparser)</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_get_option_tuples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_string</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># option strings starting with two prefix characters are only</span>
        <span class="c"># split at the &#39;=&#39;</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
        <span class="k">if</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">option_string</span><span class="p">:</span>
                <span class="n">option_prefix</span><span class="p">,</span> <span class="n">explicit_arg</span> <span class="o">=</span> <span class="n">option_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_prefix</span> <span class="o">=</span> <span class="n">option_string</span>
                <span class="n">explicit_arg</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">option_prefix</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

        <span class="c"># single character options can be concatenated with their arguments</span>
        <span class="c"># but multiple character options always have to have their argument</span>
        <span class="c"># separate</span>
        <span class="k">elif</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">chars</span> <span class="ow">and</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
            <span class="n">option_prefix</span> <span class="o">=</span> <span class="n">option_string</span>
            <span class="n">explicit_arg</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">short_option_prefix</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">short_explicit_arg</span> <span class="o">=</span> <span class="n">option_string</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

            <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">option_string</span> <span class="o">==</span> <span class="n">short_option_prefix</span><span class="p">:</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">short_explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">option_string</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">option_prefix</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_string_actions</span><span class="p">[</span><span class="n">option_string</span><span class="p">]</span>
                    <span class="n">tup</span> <span class="o">=</span> <span class="n">action</span><span class="p">,</span> <span class="n">option_string</span><span class="p">,</span> <span class="n">explicit_arg</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>

        <span class="c"># shouldn&#39;t ever get here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;unexpected option string: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">option_string</span><span class="p">)</span>

        <span class="c"># return the collected option tuples</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_get_nargs_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="c"># in all examples below, we have to allow for &#39;--&#39; args</span>
        <span class="c"># which are represented as &#39;-&#39; in the pattern</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span>

        <span class="c"># the default (None) is assumed to be a single argument</span>
        <span class="k">if</span> <span class="n">nargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A-*)&#39;</span>

        <span class="c"># allow zero or one arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A?-*)&#39;</span>

        <span class="c"># allow zero or more arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*[A-]*)&#39;</span>

        <span class="c"># allow one or more arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">ONE_OR_MORE</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A[A-]*)&#39;</span>

        <span class="c"># allow any number of options or arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;([-AO]*)&#39;</span>

        <span class="c"># allow one argument followed by any number of options or arguments</span>
        <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*A[-AO]*)&#39;</span>

        <span class="c"># all others should be integers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="s">&#39;(-*</span><span class="si">%s</span><span class="s">-*)&#39;</span> <span class="o">%</span> <span class="s">&#39;-*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;A&#39;</span> <span class="o">*</span> <span class="n">nargs</span><span class="p">)</span>

        <span class="c"># if this is an optional action, -- is not allowed</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="n">nargs_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-*&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">nargs_pattern</span> <span class="o">=</span> <span class="n">nargs_pattern</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="c"># return the pattern</span>
        <span class="k">return</span> <span class="n">nargs_pattern</span>

    <span class="c"># ========================</span>
    <span class="c"># Value conversion methods</span>
    <span class="c"># ========================</span>
    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_strings</span><span class="p">):</span>
        <span class="c"># for everything but PARSER args, strip out &#39;--&#39;</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PARSER</span><span class="p">,</span> <span class="n">REMAINDER</span><span class="p">]:</span>
            <span class="n">arg_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">arg_strings</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="s">&#39;--&#39;</span><span class="p">]</span>

        <span class="c"># optional argument produces a default when not present</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arg_strings</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">const</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># when nargs=&#39;*&#39; on a positional, if there were no command-line</span>
        <span class="c"># args, use the default if it is anything other than None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">arg_strings</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span> <span class="ow">and</span>
              <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">arg_strings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># single argument or optional argument produces a single value</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_strings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">OPTIONAL</span><span class="p">]:</span>
            <span class="n">arg_string</span><span class="p">,</span> <span class="o">=</span> <span class="n">arg_strings</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># REMAINDER arguments convert all values, checking none</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>

        <span class="c"># PARSER arguments convert all values, but check only the first</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c"># all other types of nargs produce a list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arg_strings</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="c"># return the converted value</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">):</span>
        <span class="n">type_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry_get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">type_func</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not callable&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">type_func</span><span class="p">)</span>

        <span class="c"># convert the value to the appropriate type</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">type_func</span><span class="p">(</span><span class="n">arg_string</span><span class="p">)</span>

        <span class="c"># ArgumentTypeErrors indicate errors</span>
        <span class="k">except</span> <span class="n">ArgumentTypeError</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&#39;__name__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c"># TypeErrors or ValueErrors also indicate errors</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s">&#39;__name__&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid </span><span class="si">%s</span><span class="s"> value: </span><span class="si">%r</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arg_string</span><span class="p">))</span>

        <span class="c"># return the converted value</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c"># converted value must be one of the choices (if specified)</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;invalid choice: </span><span class="si">%r</span><span class="s"> (choose from </span><span class="si">%s</span><span class="s">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="k">raise</span> <span class="n">ArgumentError</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Help-formatting methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>

        <span class="c"># usage</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>

        <span class="c"># description</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="c"># positionals, optionals and user-defined groups</span>
        <span class="k">for</span> <span class="n">action_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">start_section</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
            <span class="n">formatter</span><span class="o">.</span><span class="n">end_section</span><span class="p">()</span>

        <span class="c"># epilog</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epilog</span><span class="p">)</span>

        <span class="c"># determine help from format above</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">format_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s">&#39;The format_version method is deprecated -- the &quot;version&quot; &#39;</span>
            <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter_class</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">)</span>

    <span class="c"># =====================</span>
    <span class="c"># Help-printing methods</span>
    <span class="c"># =====================</span>
    <span class="k">def</span> <span class="nf">print_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_usage</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_help</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s">&#39;The print_version method is deprecated -- the &quot;version&quot; &#39;</span>
            <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_version</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c"># ===============</span>
    <span class="c"># Exiting methods</span>
    <span class="c"># ===============</span>
    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;error(message: string)</span>

<span class="sd">        Prints a usage message incorporating the message to stderr and</span>
<span class="sd">        exits.</span>

<span class="sd">        If you override this in a subclass, it should not return -- it</span>
<span class="sd">        should either exit or raise an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_usage</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: error: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.ArgumentParser">ArgumentParser</a></li>
          <li>smashlib.contrib.autojump._AttributeHolder</li>
          <li>smashlib.contrib.autojump._ActionsContainer</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.add_help" class="name">var <span class="ident">add_help</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.epilog" class="name">var <span class="ident">epilog</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.formatter_class" class="name">var <span class="ident">formatter_class</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.fromfile_prefix_chars" class="name">var <span class="ident">fromfile_prefix_chars</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.prog" class="name">var <span class="ident">prog</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.usage" class="name">var <span class="ident">usage</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentParser.version" class="name">var <span class="ident">version</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, prog=None, usage=None, description=None, epilog=None, version=None, parents=[], formatter_class=&lt;class &#39;smashlib.contrib.autojump.HelpFormatter&#39;&gt;, prefix_chars=&#39;-&#39;, fromfile_prefix_chars=None, argument_default=None, conflict_handler=&#39;error&#39;, add_help=True)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">prog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">usage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">epilog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">parents</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">formatter_class</span><span class="o">=</span><span class="n">HelpFormatter</span><span class="p">,</span>
             <span class="n">prefix_chars</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span>
             <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">argument_default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">conflict_handler</span><span class="o">=</span><span class="s">&#39;error&#39;</span><span class="p">,</span>
             <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;The &quot;version&quot; argument to ArgumentParser is deprecated. &quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;Please use &quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;&quot;add_argument(..., action=&#39;version&#39;, version=&quot;N&quot;, ...)&quot; &quot;&quot;&quot;</span>
            <span class="sd">&quot;&quot;&quot;instead&quot;&quot;&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">superinit</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArgumentParser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span>
    <span class="n">superinit</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
              <span class="n">prefix_chars</span><span class="o">=</span><span class="n">prefix_chars</span><span class="p">,</span>
              <span class="n">argument_default</span><span class="o">=</span><span class="n">argument_default</span><span class="p">,</span>
              <span class="n">conflict_handler</span><span class="o">=</span><span class="n">conflict_handler</span><span class="p">)</span>
    <span class="c"># default setting for prog</span>
    <span class="k">if</span> <span class="n">prog</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epilog</span> <span class="o">=</span> <span class="n">epilog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">formatter_class</span> <span class="o">=</span> <span class="n">formatter_class</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fromfile_prefix_chars</span> <span class="o">=</span> <span class="n">fromfile_prefix_chars</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span> <span class="o">=</span> <span class="n">add_help</span>
    <span class="n">add_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;positional arguments&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_optionals</span> <span class="o">=</span> <span class="n">add_group</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;optional arguments&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c"># register types</span>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">string</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">identity</span><span class="p">)</span>
    <span class="c"># add help and version arguments if necessary</span>
    <span class="c"># (using explicit default to override global argument_default)</span>
    <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">prefix_chars</span><span class="p">:</span>
        <span class="n">default_prefix</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">default_prefix</span> <span class="o">=</span> <span class="n">prefix_chars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_help</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;help&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;show this help message and exit&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="n">default_prefix</span> <span class="o">+</span> <span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="n">default_prefix</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="s">&#39;version&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">SUPPRESS</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;show program&#39;s version number and exit&quot;</span><span class="p">))</span>
    <span class="c"># add parent arguments and defaults</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_container_actions</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_defaults</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.add_argument">
    <p>def <span class="ident">add_argument</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>add_argument(dest, ..., name=value, ...)
add_argument(option_string, option_string, ..., name=value, ...)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.add_argument', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.add_argument" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    add_argument(dest, ..., name=value, ...)</span>
<span class="sd">    add_argument(option_string, option_string, ..., name=value, ...)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># if no positional args are supplied or only one is supplied and</span>
    <span class="c"># it doesn&#39;t look like an option string, parse a positional</span>
    <span class="c"># argument</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_chars</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="s">&#39;dest&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;dest supplied twice for positional argument&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c"># otherwise, we&#39;re adding an optional argument</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optional_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c"># if no default was supplied, use the parser-level default</span>
    <span class="k">if</span> <span class="s">&#39;default&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dest&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">argument_default</span>
    <span class="c"># create the action object, and add it to the parser</span>
    <span class="n">action_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_action_class</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">action_class</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknown action &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">action_class</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">action_class</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c"># raise an error if the action type is not callable</span>
    <span class="n">type_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registry_get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_callable</span><span class="p">(</span><span class="n">type_func</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="s"> is not callable&#39;</span> <span class="o">%</span> <span class="n">type_func</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.add_argument_group">
    <p>def <span class="ident">add_argument_group</span>(</p><p>self, *args, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.add_argument_group', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.add_argument_group" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">_ArgumentGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">group</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.add_mutually_exclusive_group">
    <p>def <span class="ident">add_mutually_exclusive_group</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.add_mutually_exclusive_group', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.add_mutually_exclusive_group" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_mutually_exclusive_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">_MutuallyExclusiveGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">group</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.add_subparsers">
    <p>def <span class="ident">add_subparsers</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.add_subparsers', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.add_subparsers" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_subparsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;cannot have multiple subparser arguments&#39;</span><span class="p">))</span>
    <span class="c"># add the parser class to the arguments if it&#39;s not present</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;parser_class&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="k">if</span> <span class="s">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="s">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;subcommands&#39;</span><span class="p">))</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_positionals</span>
    <span class="c"># prog defaults to the usage message of this parser, skipping</span>
    <span class="c"># optional arguments and with no &quot;usage:&quot; prefix</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prog&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
        <span class="n">positionals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_positional_actions</span><span class="p">()</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;prog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="c"># create the parsers action and add it to the positionals list</span>
    <span class="n">parsers_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop_action_class</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s">&#39;parsers&#39;</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">parsers_class</span><span class="p">(</span><span class="n">option_strings</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_subparsers</span><span class="o">.</span><span class="n">_add_action</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="c"># return the created parsers action</span>
    <span class="k">return</span> <span class="n">action</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.convert_arg_line_to_args">
    <p>def <span class="ident">convert_arg_line_to_args</span>(</p><p>self, arg_line)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.convert_arg_line_to_args', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.convert_arg_line_to_args" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">convert_arg_line_to_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_line</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">arg_line</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.error">
    <p>def <span class="ident">error</span>(</p><p>self, message)</p>
    </div>
    

    
  
    <div class="desc"><p>error(message: string)</p>
<p>Prints a usage message incorporating the message to stderr and
exits.</p>
<p>If you override this in a subclass, it should not return -- it
should either exit or raise an exception.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.error', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.error" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;error(message: string)</span>
<span class="sd">    Prints a usage message incorporating the message to stderr and</span>
<span class="sd">    exits.</span>
<span class="sd">    If you override this in a subclass, it should not return -- it</span>
<span class="sd">    should either exit or raise an exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">print_usage</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: error: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prog</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.exit">
    <p>def <span class="ident">exit</span>(</p><p>self, status=0, message=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.exit', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.exit" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.format_help">
    <p>def <span class="ident">format_help</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.format_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.format_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
    <span class="c"># usage</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>
    <span class="c"># description</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="c"># positionals, optionals and user-defined groups</span>
    <span class="k">for</span> <span class="n">action_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_groups</span><span class="p">:</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">start_section</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">action_group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">end_section</span><span class="p">()</span>
    <span class="c"># epilog</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epilog</span><span class="p">)</span>
    <span class="c"># determine help from format above</span>
    <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.format_usage">
    <p>def <span class="ident">format_usage</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.format_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.format_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_mutually_exclusive_groups</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.format_version">
    <p>def <span class="ident">format_version</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.format_version', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.format_version" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s">&#39;The format_version method is deprecated -- the &quot;version&quot; &#39;</span>
        <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
        <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatter</span><span class="p">()</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.get_default">
    <p>def <span class="ident">get_default</span>(</p><p>self, dest)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.get_default', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.get_default" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="o">==</span> <span class="n">dest</span> <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.parse_args">
    <p>def <span class="ident">parse_args</span>(</p><p>self, args=None, namespace=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.parse_args', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.parse_args" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">argv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">argv</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;unrecognized arguments: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">args</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.parse_known_args">
    <p>def <span class="ident">parse_known_args</span>(</p><p>self, args=None, namespace=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.parse_known_args', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.parse_known_args" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">parse_known_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># args default to the system args</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c"># default Namespace built from parser defaults</span>
    <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">()</span>
    <span class="c"># add any action defaults that aren&#39;t present</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">default</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
    <span class="c"># add any parser defaults that aren&#39;t present</span>
    <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">])</span>
    <span class="c"># parse the arguments and exit if there are any errors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">))</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">_UNRECOGNIZED_ARGS_ATTR</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">args</span>
    <span class="k">except</span> <span class="n">ArgumentError</span><span class="p">:</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.print_help">
    <p>def <span class="ident">print_help</span>(</p><p>self, file=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.print_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.print_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_help</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.print_usage">
    <p>def <span class="ident">print_usage</span>(</p><p>self, file=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.print_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.print_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_usage</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.print_version">
    <p>def <span class="ident">print_version</span>(</p><p>self, file=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.print_version', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.print_version" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s">&#39;The print_version method is deprecated -- the &quot;version&quot; &#39;</span>
        <span class="s">&#39;argument to ArgumentParser is no longer supported.&#39;</span><span class="p">,</span>
        <span class="ne">DeprecationWarning</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_print_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_version</span><span class="p">(),</span> <span class="nb">file</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.register">
    <p>def <span class="ident">register</span>(</p><p>self, registry_name, value, object)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.register', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.register" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registry_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
    <span class="n">registry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registries</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">registry_name</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">registry</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="nb">object</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.ArgumentParser.set_defaults">
    <p>def <span class="ident">set_defaults</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentParser.set_defaults', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentParser.set_defaults" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c"># if these defaults match any existing arguments, replace</span>
    <span class="c"># the previous default on the object with the new one</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">action</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.ArgumentTypeError" class="name">class <span class="ident">ArgumentTypeError</span></p>
      
  
    <div class="desc"><p>An error from trying to convert a command line string to a type.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.ArgumentTypeError', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.ArgumentTypeError" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ArgumentTypeError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;An error from trying to convert a command line string to a type.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.ArgumentTypeError">ArgumentTypeError</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentTypeError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.ArgumentTypeError.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.Entry" class="name">class <span class="ident">Entry</span></p>
      
  
    <div class="desc"><p>Entry(path, weight)</p></div>
  <div class="source_cont">
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.Entry">Entry</a></li>
          <li>__builtin__.tuple</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="smashlib.contrib.autojump.Entry.path" class="name">var <span class="ident">path</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 0</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="smashlib.contrib.autojump.Entry.weight" class="name">var <span class="ident">weight</span></p>
            

            
  
    <div class="desc"><p>Alias for field number 1</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.FileType" class="name">class <span class="ident">FileType</span></p>
      
  
    <div class="desc"><p>Factory for creating file object types</p>
<p>Instances of FileType are typically passed as type= arguments to the
ArgumentParser add_argument() method.</p>
<p>Keyword Arguments:
    - mode -- A string indicating how the file is to be opened. Accepts the
        same values as the builtin open() function.
    - bufsize -- The file's desired buffer size. Accepts the same values as
        the builtin open() function.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.FileType', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.FileType" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">FileType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Factory for creating file object types</span>

<span class="sd">    Instances of FileType are typically passed as type= arguments to the</span>
<span class="sd">    ArgumentParser add_argument() method.</span>

<span class="sd">    Keyword Arguments:</span>
<span class="sd">        - mode -- A string indicating how the file is to be opened. Accepts the</span>
<span class="sd">            same values as the builtin open() function.</span>
<span class="sd">        - bufsize -- The file&#39;s desired buffer size. Accepts the same values as</span>
<span class="sd">            the builtin open() function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span> <span class="o">=</span> <span class="n">bufsize</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="c"># the special argument &quot;-&quot; means sys.std{in,out}</span>
        <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">elif</span> <span class="s">&#39;w&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;argument &quot;-&quot; with mode </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c"># all other arguments are used as file names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span><span class="p">]</span>
        <span class="n">args_str</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">args_str</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.FileType">FileType</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.FileType.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, mode=&#39;r&#39;, bufsize=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.FileType.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.FileType.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bufsize</span> <span class="o">=</span> <span class="n">bufsize</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.HelpFormatter" class="name">class <span class="ident">HelpFormatter</span></p>
      
  
    <div class="desc"><p>Formatter for generating usage messages and argument help strings.</p>
<p>Only the name of this class is considered a public API. All the methods
provided by the class are considered an implementation detail.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">HelpFormatter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Formatter for generating usage messages and argument help strings.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">prog</span><span class="p">,</span>
                 <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="c"># default setting for width</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
            <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>

    <span class="c"># ===============================</span>
    <span class="c"># Section and indentation methods</span>
    <span class="c"># ===============================</span>
    <span class="k">def</span> <span class="nf">_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_dedent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;Indent decreased below 0.&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">class</span> <span class="nc">_Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">heading</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="n">heading</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c"># format the indented section</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
            <span class="n">join</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_join_parts</span>
            <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="n">item_help</span> <span class="o">=</span> <span class="n">join</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

            <span class="c"># return nothing if the section was empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item_help</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;&#39;</span>

            <span class="c"># add the heading if the section was non-empty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">current_indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">_current_indent</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">heading</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heading</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

            <span class="c"># join the section-initial newline, the heading and the help</span>
            <span class="k">return</span> <span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">item_help</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

    <span class="c"># ========================</span>
    <span class="c"># Message building methods</span>
    <span class="c"># ========================</span>
    <span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
        <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>

    <span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>

            <span class="c"># find all invocations</span>
            <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
            <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
                <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>

            <span class="c"># update the maximum item length</span>
            <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
            <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                          <span class="n">action_length</span><span class="p">)</span>

            <span class="c"># add the item to the list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="c"># =======================</span>
    <span class="c"># Help-formatting methods</span>
    <span class="c"># =======================</span>
    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
            <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
            <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">return</span> <span class="n">help</span>

    <span class="k">def</span> <span class="nf">_join_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_strings</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">part</span>
                        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">part_strings</span>
                        <span class="k">if</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">part</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;usage: &#39;</span><span class="p">)</span>

        <span class="c"># if usage is specified, use that</span>
        <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

        <span class="c"># if no optionals or positionals are available, usage is just prog</span>
        <span class="k">elif</span> <span class="n">usage</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">actions</span><span class="p">:</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

        <span class="c"># if optionals and positionals are available, calculate usage</span>
        <span class="k">elif</span> <span class="n">usage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prog</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>

            <span class="c"># split optionals from positionals</span>
            <span class="n">optionals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">positionals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="n">optionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">positionals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="c"># build full usage string</span>
            <span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_actions_usage</span>
            <span class="n">action_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">optionals</span> <span class="o">+</span> <span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">prog</span><span class="p">,</span> <span class="n">action_usage</span><span class="p">]</span> <span class="k">if</span> <span class="n">s</span><span class="p">])</span>

            <span class="c"># wrap the usage parts if it&#39;s too long</span>
            <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">text_width</span><span class="p">:</span>

                <span class="c"># break usage into wrappable parts</span>
                <span class="n">part_regexp</span> <span class="o">=</span> <span class="s">r&#39;\(.*?\)+|\[.*?\]+|\S+&#39;</span>
                <span class="n">opt_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">optionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
                <span class="n">pos_usage</span> <span class="o">=</span> <span class="n">format</span><span class="p">(</span><span class="n">positionals</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
                <span class="n">opt_parts</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">part_regexp</span><span class="p">,</span> <span class="n">opt_usage</span><span class="p">)</span>
                <span class="n">pos_parts</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">part_regexp</span><span class="p">,</span> <span class="n">pos_usage</span><span class="p">)</span>
                <span class="k">assert</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opt_parts</span><span class="p">)</span> <span class="o">==</span> <span class="n">opt_usage</span>
                <span class="k">assert</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">)</span> <span class="o">==</span> <span class="n">pos_usage</span>

                <span class="c"># helper for wrapping lines</span>
                <span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">line_len</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">text_width</span><span class="p">:</span>
                            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                            <span class="n">line</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">line_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                        <span class="n">line_len</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">indent</span><span class="p">):]</span>
                    <span class="k">return</span> <span class="n">lines</span>

                <span class="c"># if prog is short, follow it with optionals or positionals</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">text_width</span><span class="p">:</span>
                    <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">opt_parts</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">([</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">opt_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">pos_parts</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">([</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">prog</span><span class="p">]</span>

                <span class="c"># if prog is long, put it on its own line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">opt_parts</span> <span class="o">+</span> <span class="n">pos_parts</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">opt_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_lines</span><span class="p">(</span><span class="n">pos_parts</span><span class="p">,</span> <span class="n">indent</span><span class="p">))</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">prog</span><span class="p">]</span> <span class="o">+</span> <span class="n">lines</span>

                <span class="c"># join lines into usage</span>
                <span class="n">usage</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

        <span class="c"># prefix with &#39;usage:&#39;</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">usage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_actions_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
        <span class="c"># find group indices and identify actions in groups</span>
        <span class="n">group_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">inserts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">actions</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">_group_actions</span><span class="p">:</span>
                        <span class="n">group_actions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">group</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">inserts</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; [&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;]&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">start</span> <span class="ow">in</span> <span class="n">inserts</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+=</span> <span class="s">&#39; (&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">inserts</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;)&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                        <span class="n">inserts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;|&#39;</span>

        <span class="c"># collect all actions format strings</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">actions</span><span class="p">):</span>

            <span class="c"># suppressed arguments are marked with None</span>
            <span class="c"># remove | separators for suppressed arguments</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inserts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                    <span class="n">inserts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">inserts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;|&#39;</span><span class="p">:</span>
                    <span class="n">inserts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c"># produce all arg strings</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>

                <span class="c"># if it&#39;s in a group, strip the outer []</span>
                <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">group_actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span> <span class="ow">and</span> <span class="n">part</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;]&#39;</span><span class="p">:</span>
                        <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c"># add the action string to the list</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

            <span class="c"># produce the first way to invoke the option in brackets</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">option_string</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c"># if the Optional doesn&#39;t take a value, format is:</span>
                <span class="c">#    -s or --long</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">option_string</span>

                <span class="c"># if the Optional takes a value, format is:</span>
                <span class="c">#    -s ARGS or --long ARGS</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">args_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="n">args_string</span><span class="p">)</span>

                <span class="c"># make it look optional if it&#39;s not required or in a group</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">required</span> <span class="ow">and</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group_actions</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">part</span>

                <span class="c"># add the action string to the list</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

        <span class="c"># insert things at the necessary indices</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">inserts</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">inserts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="c"># join all the action items with spaces</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parts</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">])</span>

        <span class="c"># clean up separators for mutually exclusive groups</span>
        <span class="nb">open</span> <span class="o">=</span> <span class="s">r&#39;[\[(]&#39;</span>
        <span class="n">close</span> <span class="o">=</span> <span class="s">r&#39;[\])]&#39;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;(</span><span class="si">%s</span><span class="s">) &#39;</span> <span class="o">%</span> <span class="nb">open</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">close</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;</span><span class="si">%s</span><span class="s"> *</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">open</span><span class="p">,</span> <span class="n">close</span><span class="p">),</span> <span class="s">r&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\(([^|]*)\)&#39;</span><span class="p">,</span> <span class="s">r&#39;\1&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c"># return the text</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;%(prog)&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">%</span> <span class="nb">dict</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>
        <span class="n">text_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_width</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">_format_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="c"># determine the required width and the entry label</span>
        <span class="n">help_position</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span><span class="p">)</span>
        <span class="n">help_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">-</span> <span class="n">help_position</span>
        <span class="n">action_width</span> <span class="o">=</span> <span class="n">help_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">action_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c"># ho nelp; start on same line and add a final newline</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tup</span>

        <span class="c"># short action name; start on the same line and pad two spaces</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">action_header</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">action_width</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_width</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%-*s</span><span class="s">  &#39;</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># long action name; start on the next line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">action_header</span>
            <span class="n">action_header</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tup</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="n">help_position</span>

        <span class="c"># collect the pieces of the action help</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">action_header</span><span class="p">]</span>

        <span class="c"># if there was help for the action, add lines of help text</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">help_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_help</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="n">help_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_lines</span><span class="p">(</span><span class="n">help_text</span><span class="p">,</span> <span class="n">help_width</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent_first</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">help_position</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

        <span class="c"># or add a newline if the description doesn&#39;t end with one</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">action_header</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># if there are any sub-actions, add their help as well</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>

        <span class="c"># return a single string</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_action_invocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
            <span class="n">metavar</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metavar_formatter</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metavar</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c"># if the Optional doesn&#39;t take a value, format is:</span>
            <span class="c">#    -s, --long</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">)</span>

            <span class="c"># if the Optional takes a value, format is:</span>
            <span class="c">#    -s ARGS, --long ARGS</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">default</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">args_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_args</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">option_string</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">option_strings</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option_string</span><span class="p">,</span> <span class="n">args_string</span><span class="p">))</span>

            <span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_metavar_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">metavar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">metavar</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">choice_strs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="n">action</span><span class="o">.</span><span class="n">choices</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">choice_strs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">default_metavar</span>

        <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">tuple_size</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">tuple_size</span>
        <span class="k">return</span> <span class="n">format</span>

    <span class="k">def</span> <span class="nf">_format_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">):</span>
        <span class="n">get_metavar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metavar_formatter</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">default_metavar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">OPTIONAL</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ZERO_OR_MORE</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s"> ...]]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">ONE_OR_MORE</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s"> ...]&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">REMAINDER</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;...&#39;</span>
        <span class="k">elif</span> <span class="n">action</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="n">PARSER</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> ...&#39;</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">)]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span> <span class="o">%</span> <span class="n">get_metavar</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">nargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_expand_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">action</span><span class="p">),</span> <span class="n">prog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prog</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">is</span> <span class="n">SUPPRESS</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="s">&#39;__name__&#39;</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;choices&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">choices_str</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;choices&#39;</span><span class="p">]])</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">choices_str</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_help_string</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="o">%</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">_iter_indented_subactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">get_subactions</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">_get_subactions</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="n">get_subactions</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">subaction</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_split_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fill_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">initial_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                              <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_help_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, prog, indent_increment=2, max_help_position=24, width=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">prog</span><span class="p">,</span>
             <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># default setting for width</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.add_argument">
    <p>def <span class="ident">add_argument</span>(</p><p>self, action)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.add_argument', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.add_argument" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="c"># find all invocations</span>
        <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
        <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>
        <span class="c"># update the maximum item length</span>
        <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
        <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                      <span class="n">action_length</span><span class="p">)</span>
        <span class="c"># add the item to the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.add_arguments">
    <p>def <span class="ident">add_arguments</span>(</p><p>self, actions)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.add_arguments', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.add_arguments" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.add_text">
    <p>def <span class="ident">add_text</span>(</p><p>self, text)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.add_text', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.add_text" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.add_usage">
    <p>def <span class="ident">add_usage</span>(</p><p>self, usage, actions, groups, prefix=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.add_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.add_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.end_section">
    <p>def <span class="ident">end_section</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.end_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.end_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.format_help">
    <p>def <span class="ident">format_help</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.format_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.format_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">help</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.HelpFormatter.start_section">
    <p>def <span class="ident">start_section</span>(</p><p>self, heading)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.HelpFormatter.start_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.HelpFormatter.start_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
    <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.Namespace" class="name">class <span class="ident">Namespace</span></p>
      
  
    <div class="desc"><p>Simple object for storing attributes.</p>
<p>Implements equality by attribute names and values, and provides a simple
string representation.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.Namespace', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.Namespace" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">Namespace</span><span class="p">(</span><span class="n">_AttributeHolder</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Simple object for storing attributes.</span>

<span class="sd">    Implements equality by attribute names and values, and provides a simple</span>
<span class="sd">    string representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="n">__hash__</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">vars</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.Namespace">Namespace</a></li>
          <li>smashlib.contrib.autojump._AttributeHolder</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.Namespace.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.Namespace.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.Namespace.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.RawDescriptionHelpFormatter" class="name">class <span class="ident">RawDescriptionHelpFormatter</span></p>
      
  
    <div class="desc"><p>Help message formatter which retains any formatting in descriptions.</p>
<p>Only the name of this class is considered a public API. All the methods
provided by the class are considered an implementation detail.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">RawDescriptionHelpFormatter</span><span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which retains any formatting in descriptions.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_fill_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">indent</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="bp">True</span><span class="p">)])</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></li>
          <li><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, prog, indent_increment=2, max_help_position=24, width=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">prog</span><span class="p">,</span>
             <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># default setting for width</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_argument">
    <p>def <span class="ident">add_argument</span>(</p><p>self, action)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_argument">add_argument</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_argument', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_argument" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="c"># find all invocations</span>
        <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
        <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>
        <span class="c"># update the maximum item length</span>
        <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
        <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                      <span class="n">action_length</span><span class="p">)</span>
        <span class="c"># add the item to the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_arguments">
    <p>def <span class="ident">add_arguments</span>(</p><p>self, actions)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_arguments">add_arguments</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_arguments', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_arguments" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_text">
    <p>def <span class="ident">add_text</span>(</p><p>self, text)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_text">add_text</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_text', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_text" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_usage">
    <p>def <span class="ident">add_usage</span>(</p><p>self, usage, actions, groups, prefix=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.add_usage">add_usage</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.end_section">
    <p>def <span class="ident">end_section</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.end_section">end_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.end_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.end_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.format_help">
    <p>def <span class="ident">format_help</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.format_help">format_help</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.format_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.format_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">help</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawDescriptionHelpFormatter.start_section">
    <p>def <span class="ident">start_section</span>(</p><p>self, heading)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.HelpFormatter.start_section">start_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.start_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawDescriptionHelpFormatter.start_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
    <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="smashlib.contrib.autojump.RawTextHelpFormatter" class="name">class <span class="ident">RawTextHelpFormatter</span></p>
      
  
    <div class="desc"><p>Help message formatter which retains formatting of all help text.</p>
<p>Only the name of this class is considered a public API. All the methods
provided by the class are considered an implementation detail.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">RawTextHelpFormatter</span><span class="p">(</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Help message formatter which retains formatting of all help text.</span>

<span class="sd">    Only the name of this class is considered a public API. All the methods</span>
<span class="sd">    provided by the class are considered an implementation detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_split_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#smashlib.contrib.autojump.RawTextHelpFormatter">RawTextHelpFormatter</a></li>
          <li><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></li>
          <li><a href="#smashlib.contrib.autojump.HelpFormatter">HelpFormatter</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, prog, indent_increment=2, max_help_position=24, width=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.__init__">__init__</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">prog</span><span class="p">,</span>
             <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># default setting for width</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prog</span> <span class="o">=</span> <span class="n">prog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_help_position</span> <span class="o">=</span> <span class="n">max_help_position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">=</span> <span class="n">width</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_whitespace_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\s+&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\n\n\n+&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.add_argument">
    <p>def <span class="ident">add_argument</span>(</p><p>self, action)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_argument">add_argument</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.add_argument', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.add_argument" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_argument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="c"># find all invocations</span>
        <span class="n">get_invocation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_action_invocation</span>
        <span class="n">invocations</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">action</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">subaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_indented_subactions</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="n">invocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_invocation</span><span class="p">(</span><span class="n">subaction</span><span class="p">))</span>
        <span class="c"># update the maximum item length</span>
        <span class="n">invocation_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">invocations</span><span class="p">])</span>
        <span class="n">action_length</span> <span class="o">=</span> <span class="n">invocation_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_indent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_action_max_length</span><span class="p">,</span>
                                      <span class="n">action_length</span><span class="p">)</span>
        <span class="c"># add the item to the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_action</span><span class="p">,</span> <span class="p">[</span><span class="n">action</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.add_arguments">
    <p>def <span class="ident">add_arguments</span>(</p><p>self, actions)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_arguments">add_arguments</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.add_arguments', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.add_arguments" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.add_text">
    <p>def <span class="ident">add_text</span>(</p><p>self, text)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_text">add_text</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.add_text', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.add_text" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span> <span class="ow">and</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">,</span> <span class="p">[</span><span class="n">text</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.add_usage">
    <p>def <span class="ident">add_usage</span>(</p><p>self, usage, actions, groups, prefix=None)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.add_usage">add_usage</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.add_usage', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.add_usage" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">SUPPRESS</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">usage</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.end_section">
    <p>def <span class="ident">end_section</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.end_section">end_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.end_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.end_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">end_section</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="o">.</span><span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dedent</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.format_help">
    <p>def <span class="ident">format_help</span>(</p><p>self)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.format_help">format_help</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.format_help', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.format_help" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_section</span><span class="o">.</span><span class="n">format_help</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">help</span><span class="p">:</span>
        <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_break_matcher</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="p">)</span>
        <span class="n">help</span> <span class="o">=</span> <span class="n">help</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">help</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="smashlib.contrib.autojump.RawTextHelpFormatter.start_section">
    <p>def <span class="ident">start_section</span>(</p><p>self, heading)</p>
    </div>
    
    <p class="inheritance">
     <strong>Inheritance:</strong>
       <code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter">RawDescriptionHelpFormatter</a></code>.<code><a href="#smashlib.contrib.autojump.RawDescriptionHelpFormatter.start_section">start_section</a></code>
    </p>

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-smashlib.contrib.autojump.RawTextHelpFormatter.start_section', this);">Show source &equiv;</a></p>
  <div id="source-smashlib.contrib.autojump.RawTextHelpFormatter.start_section" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">start_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_indent</span><span class="p">()</span>
    <span class="n">section</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_item</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">format_help</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_current_section</span> <span class="o">=</span> <span class="n">section</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
